Sjasm Z80 Assembler v0.42b8 - www.xl2s.tk             [2019.03.04 - 22:15:09]

src\main128.asm
Errors: 0

       1   00:0000                      
       2   00:0000                      
       3   00:0000                      	incdir data_bin/
       4   00:0000                      
       5   00:0000                      	include parameters.asm
       1.  00:0000  (00:0040)           LvlWidth:  equ 64
       2.  00:0000  (00:004F)           LvlHeigh:  equ 79
       3.  00:0000  (00:009F)           CommonTiles:  equ 159
       4.  00:0000  (00:00BE)           TileSize11:  equ 190
       5.  00:0000  (00:00D2)           TileSize13:  equ 210
       6.  00:0000  (00:00D6)           TileSize15:  equ 214
       7.  00:0000  (00:00D2)           TileSize17:  equ 210
       8.  00:0000  (00:00CE)           TileSize31:  equ 206
       9.  00:0000  (00:00FF)           TileSize33:  equ 255
      10.  00:0000  (00:00FF)           TileSize35:  equ 255
      11.  00:0000  (00:00FD)           TileSize37:  equ 253
      12.  00:0000  (00:00CC)           TileSize51:  equ 204
      13.  00:0000  (00:00FF)           TileSize53:  equ 255
      14.  00:0000  (00:0100)           TileSize55:  equ 256
      15.  00:0000  (00:0100)           TileSize57:  equ 256
      16.  00:0000  (00:00D2)           TileSize71:  equ 210
      17.  00:0000  (00:00FF)           TileSize73:  equ 255
      18.  00:0000  (00:0100)           TileSize75:  equ 256
      19.  00:0000  (00:00FF)           TileSize77:  equ 255
       6   00:0000                      
       7   00:0000                      	output Scrll8way128.rom
       8   00:0000                      
       9   00:0000                      	defpage	0,0x4000, 0x2000		; page 0 contains main code + far call routines
      10   00:0000                      	defpage 1,0x6000, 0x2000		; static code
      11   00:0000                      	defpage	2,0x8000, 0x2000		; static code - ISR code
      12   00:0000                      	
      13   00:0000                      	defpage	3,0xA000, 0x2000		; 
      14   00:0000                      	defpage	4,0xA000, 0x2000		; common patterns and colors
      15   00:0000                      	
      16   00:0000                      	defpage	5,0xA000, 0x2000		; sprites
      17   00:0000                      	defpage	6,0xA000, 0x2000		; meta map
      18   00:0000                      	defpage	7,0xA000, 0x2000		; metavec
      19   00:0000                      
      20   00:0000                      	defpage	 8,0xA000, 0x2000		; patterns_base
      21   00:0000                      	defpage	 9,0xA000, 0x2000		; patterns_base
      22   00:0000                      	defpage	10,0xA000, 0x2000		; patterns_base
      23   00:0000                      	defpage	11,0xA000, 0x2000		; patterns_base
      24   00:0000                      	defpage	12,0xA000, 0x2000		; colors_base
      25   00:0000                      	defpage	13,0xA000, 0x2000		; colors_base
      26   00:0000                      	defpage	14,0xA000, 0x2000		; colors_base
      27   00:0000                      	defpage	15,0xA000, 0x2000		; colors_base
      28   00:0000                      
      29   00:0000                      
      30   00:0000                      
      31   00:0000                      ; *** tile set data in rom ***
      32   00:0000  (03)                	page 3
      33   03:A000                      tileset:
      34   03:A000  (0400)              	incbin tileset.bin
      35   03:A400                      	
      36   03:A400                      	; place sprites in the score bar
      37   03:A400                      scorebar_sat:
      38   03:A400                      	repeat  4
      39   03:A400                    < 	db  5*8
      40   03:A400                    < 	db  @# * 16
      41   03:A400                    < 	db  32*4
      42   03:A400                    < 	db  0
      43   03:A400                    < 	endrepeat
      43   03:A400  28 00 80 00 28 10 80 00 28 20 80 00 28 30 80 00 
      44   03:A410  36                  	db  5*8+14
      45   03:A411  40                  	db  4*16
      46   03:A412  80                  	db  32*4
      47   03:A413  00                  	db  0
      48   03:A414  D0                  	db	0xd0
      49   03:A415                      	
      50   03:A415  (04)                	page 4
      51   04:A000                      common_pattern:
      52   04:A000  (04F8)              	incbin testpat.bin,0,CommonTiles*8
      53   04:A4F8                      common_color:
      54   04:A4F8  (04F8)              	incbin testcol.bin,0,CommonTiles*8
      55   04:A9F0                      
      56   04:A9F0  (05)                	page 5
      57   05:A000                      test_spt:
      58   05:A000  (0F50)              	incbin spt.bin
      59   05:AF50                      ;	place 32 sprites
      60   05:AF50                      test_sat:
      61   05:AF50  (05:0000)           counter:=0
      62   05:AF50                      	repeat	8
      63   05:AF50                    < 	repeat	4
      64   05:AF50                    < 	db	64 + @@# * 16
      65   05:AF50                    < 	db	48 +  @# * 32 + @@#*8
      66   05:AF50                    < 	db	6*4+(counter and %00001100)
      67   05:AF50                    < 	db	15
      68   05:AF50                    < counter:=counter+4
      69   05:AF50                    < 	endrepeat
      70   05:AF50                    < 	endrepeat
      70   05:AF50  40 30 18 0F 40 50 1C 0F 40 70 20 0F 40 90 24 0F 
      70   05:AF60  50 38 18 0F 50 58 1C 0F 50 78 20 0F 50 98 24 0F 
      70   05:AF70  60 40 18 0F 60 60 1C 0F 60 80 20 0F 60 A0 24 0F 
      70   05:AF80  70 48 18 0F 70 68 1C 0F 70 88 20 0F 70 A8 24 0F 
      70   05:AF90  80 50 18 0F 80 70 1C 0F 80 90 20 0F 80 B0 24 0F 
      70   05:AFA0  90 58 18 0F 90 78 1C 0F 90 98 20 0F 90 B8 24 0F 
      70   05:AFB0  A0 60 18 0F A0 80 1C 0F A0 A0 20 0F A0 C0 24 0F 
      70   05:AFC0  B0 68 18 0F B0 88 1C 0F B0 A8 20 0F B0 C8 24 0F 
      71   05:AFD0                      
      72   05:AFD0  (06)                	page 6
      73   06:A000                      metamap:
      74   06:A000  (13C0)              	incbin metamap.bin
      75   06:B3C0                      
      76   06:B3C0  (07)                	page 7
      77   07:A000                      metavec:
      78   07:A000  (1000)              	incbin metavec.bin
      79   07:B000                      
      80   07:B000  (08)                	page 8
      81   08:A000                      patterns_base:
      82   08:A000                      patterns11_13_15_17:
      83   08:A000  (1B08)              	incbin testpat.bin,00*2*1024+CommonTiles*8,4*2*1024-CommonTiles*8
      84   08:BB08  (09)                	page 9
      85   09:A000                      patterns31_33_35_37:
      86   09:A000  (1B08)              	incbin testpat.bin,04*2*1024+CommonTiles*8,8*1024-CommonTiles*8
      87   09:BB08  (0A)                	page 10
      88   0A:A000                      patterns51_53_55_57:
      89   0A:A000  (1B08)              	incbin testpat.bin,08*2*1024+CommonTiles*8,8*1024-CommonTiles*8
      90   0A:BB08  (0B)                	page 11
      91   0B:A000                      patterns71_73_75_77:
      92   0B:A000  (1B08)              	incbin testpat.bin,12*2*1024+CommonTiles*8,8*1024-CommonTiles*8
      93   0B:BB08                      
      94   0B:BB08  (0C)                	page 12
      95   0C:A000                      colors_base:
      96   0C:A000                      colors11_13_15_17:
      97   0C:A000  (1B08)              	incbin testcol.bin,00*2*1024+CommonTiles*8,4*2*1024-CommonTiles*8
      98   0C:BB08  (0D)                	page 13
      99   0D:A000                      colors31_33_35_37:
     100   0D:A000  (1B08)              	incbin testcol.bin,04*2*1024+CommonTiles*8,8*1024-CommonTiles*8
     101   0D:BB08  (0E)                	page 14
     102   0E:A000                      colors51_53_55_57:
     103   0E:A000  (1B08)              	incbin testcol.bin,08*2*1024+CommonTiles*8,8*1024-CommonTiles*8
     104   0E:BB08  (0F)                	page 15
     105   0F:A000                      colors71_73_75_77:
     106   0F:A000  (1B08)              	incbin testcol.bin,12*2*1024+CommonTiles*8,8*1024-CommonTiles*8
     107   0F:BB08                      
     108   0F:BB08                      
     109   0F:BB08                      
     110   0F:BB08                      
     111   0F:BB08                          macro _setVdp register,value       ; without DI/EI
     112   0F:BB08                    <     ld  a,value
     113   0F:BB08                    <     out (0x99),a
     114   0F:BB08                    <     ld  a,register + 0x80
     115   0F:BB08                    <     out (0x99),a
     116   0F:BB08                    <     endmacro
     117   0F:BB08                      
     118   0F:BB08                          macro setVdp register,value       ; macro definition
     119   0F:BB08                    <     di
     120   0F:BB08                    <     _setVdp register,value
     121   0F:BB08                    <     ei
     122   0F:BB08                    <     endmacro
     123   0F:BB08                      
     124   0F:BB08                          macro _setvdpwvram value
     125   0F:BB08                    <     if (value & 0xFF)
     126   0F:BB08                    <         ld  a,value & 0xFF
     127   0F:BB08                    <     else
     128   0F:BB08                    <         xor a
     129   0F:BB08                    <     endif
     130   0F:BB08                    <     out (0x99),a
     131   0F:BB08                    <     ld  a,0x40 + (value/256)
     132   0F:BB08                    <     out (0x99),a
     133   0F:BB08                    <     endmacro
     134   0F:BB08                      
     135   0F:BB08                          macro setvdpwvram value
     136   0F:BB08                    <     di
     137   0F:BB08                    <     _setvdpwvram value
     138   0F:BB08                    <     ei
     139   0F:BB08                    <     endmacro
     140   0F:BB08                      	
     141   0F:BB08                      ; -----------------------------
     142   0F:BB08                      ; smooth scroller demo
     143   0F:BB08                      ; Trilobyte 2014
     144   0F:BB08                      ; ------------------------------
     145   0F:BB08                      
     146   0F:BB08                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     147   0F:BB08                      ;
     148   0F:BB08                      ;   Mapper Konami 5 (mapper +  scc)
     149   0F:BB08                      ;
     150   0F:BB08                      ; Bank 1: 4000h - 5FFFh
     151   0F:BB08                      ; Bank 2: 6000h - 7FFFh
     152   0F:BB08                      ; Bank 3: 8000h - 9FFFh
     153   0F:BB08                      ; Bank 4: A000h - BFFFh
     154   0F:BB08                      
     155   0F:BB08                      ; Bank 1: 5000h - 57FFh (5000h used)
     156   0F:BB08                      ; Bank 2: 7000h - 77FFh (7000h used)
     157   0F:BB08                      ; Bank 3: 9000h - 97FFh (9000h used)
     158   0F:BB08                      ; Bank 4: B000h - B7FFh (B000h used)
     159   0F:BB08                      
     160   0F:BB08                      
     161   0F:BB08                      ; *** CONSTANTS ***
     162   0F:BB08  (0F:5000)           _bank1			equ	0x5000
     163   0F:BB08  (0F:7000)           _bank2			equ	0x7000
     164   0F:BB08  (0F:9000)           _bank3			equ	0x9000
     165   0F:BB08  (0F:B000)           _bank4			equ	0xB000
     166   0F:BB08                      
     167   0F:BB08                      ; -----------------------------
     168   0F:BB08                      ; parameters
     169   0F:BB08                      ;
     170   0F:BB08                      
     171   0F:BB08                      ;
     172   0F:BB08  (0F:0080)           maxspeed:   	equ 8*16
     173   0F:BB08  (0F:0001)           maxspeedstep:	equ	1
     174   0F:BB08                      ;
     175   0F:BB08                      ;minspeed:	equ	1		i.e. 	1/16
     176   0F:BB08                      
     177   0F:BB08                      ; ------------------------------
     178   0F:BB08                      
     179   0F:BB08                      ; *** RAM ***
     180   0F:BB08                      
     181   0F:BB08  (C000)              	map 0xc000
     182   0F:BB08                      
     183   0F:BB08  (0F:C000)           buffer:			#8*1024
     184   0F:BB08                      
     185   0F:BB08                      
     186   0F:BB08  (0F:E000)           slotvar:		#1
     187   0F:BB08  (0F:E001)           slotram:		#1
     188   0F:BB08                      
     189   0F:BB08  (0F:E002)           xmap:			#2		; FP 8.8
     190   0F:BB08  (0F:E004)           ymap:			#2		; FP 8.8
     191   0F:BB08  (0F:E006)           dxmap:			#1		; FP 4.4
     192   0F:BB08  (0F:E007)           dymap:			#1		; FP 4.4
     193   0F:BB08                      
     194   0F:BB08  (0F:E008)           phase:			#1
     195   0F:BB08  (0F:E009)           vpage:			#1
     196   0F:BB08                      
     197   0F:BB08  (0000)              	endmap
     198   0F:BB08                      
     199   0F:BB08                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     200   0F:BB08                      ; Interrupt service routine
     201   0F:BB08                      ;
     202   0F:BB08                      
     203   0F:BB08                      ; remove any processing from the ISR
     204   0F:BB08                      
     205   0F:BB08  (02)                	page 2
     206   02:8000                      myisr:
     207   02:8000  F1                   	pop	af		; 	remove return address
     208   02:8001  DB 99               	in  a,(0x99)	; 	s0 reset
     209   02:8003  DD E1                	pop    ix
     210   02:8005  FD E1               	pop    iy
     211   02:8007  F1                  	pop    af
     212   02:8008  C1                  	pop    bc
     213   02:8009  D1                  	pop    de
     214   02:800A  E1                  	pop    hl
     215   02:800B  08                  	ex     af,af'
     216   02:800C  D9                  	exx
     217   02:800D  F1                  	pop    af
     218   02:800E  C1                  	pop    bc
     219   02:800F  D1                  	pop    de
     220   02:8010  E1                  	pop    hl
     221   02:8011  FB                  	ei
     222   02:8012  C9                  	ret
     223   02:8013                      	
     224   02:8013                      ;	push   hl
     225   02:8013                      ;	push   de
     226   02:8013                      ;	push   bc
     227   02:8013                      ;	push   af
     228   02:8013                      ;	exx
     229   02:8013                      ;	ex     af,af'
     230   02:8013                      ;	push   hl
     231   02:8013                      ;	push   de
     232   02:8013                      ;	push   bc
     233   02:8013                      ;	push   af
     234   02:8013                      ;	push   iy
     235   02:8013                      ;	push   ix
     236   02:8013                      
     237   02:8013                      ;	disabled code for future developments
     238   02:8013                      
     239   02:8013                      ;	pop		af		; 	remove return address
     240   02:8013                      
     241   02:8013                      ;	_setVdp 0,0x00  ; 	screen 1
     242   02:8013                      
     243   02:8013                      ;	_setVdp 4,0x03  ; 	PGT at 1800h (used from 0x1C00 to 0x1FFF, only 128 characters)
     244   02:8013                      ;	_setVdp 3,0x6F  ; 	PCT at 1BC0h (used from 0x1BD0 to 0x1BDF, only 16 bytes)
     245   02:8013                      
     246   02:8013                      ;	_setVdp 5,0x37  ;   SAT at 1B80
     247   02:8013                      ;	_setVdp 6,0x03  ;   SPT at 1800   (used from 0x1C00 to 0x1FFF  only 32 sprites 16x16)
     248   02:8013                      
     249   02:8013                      ;	in  a,(0x99)	; 	s0 reset
     250   02:8013                      
     251   02:8013                      	; _setVdp 7,8  	; 	
     252   02:8013                      	; call    _plot_pnt
     253   02:8013                      	; _setVdp 7,0  	; 	
     254   02:8013                      
     255   02:8013                      ;1:  in  a,(0x99)	; 	wait raster line
     256   02:8013                      ;	and %01011111
     257   02:8013                      ;	cp  %01000100	; 	plane 4 =0x44
     258   02:8013                      ;	jp  nz,1b
     259   02:8013                      
     260   02:8013                      ;	_setVdp 0,0x02  ;	screen 2
     261   02:8013                      
     262   02:8013                      ;	ld  a,(vpage)	
     263   02:8013                      ;	and a
     264   02:8013                      ;	jp  z,page0
     265   02:8013                      ;page1:				; 	page 1 active
     266   02:8013                      ;	_setVdp 3,0x9F	; 	colours at 0x2000	(hybrid)
     267   02:8013                      ;	_setVdp 4,0x03	;	patterns at 0x0000	(regular: used 0x0800 0x1000)
     268   02:8013                      ;	jp  1f
     269   02:8013                      ;page0:				; 	page 0 active
     270   02:8013                      ;	_setVdp 3,0x1F	; 	colours at 0x0000	(hybrid)
     271   02:8013                      ;	_setVdp 4,0x07	;	patterns at 0x2000	(regular: used 0x2800 0x3000)
     272   02:8013                      ;1:
     273   02:8013                      ;	_setVdp 5,0x36  ;   SAT at 0x1b00
     274   02:8013                      ;	_setVdp 6,0x07  ;   SPT at 0x3800   (64 sprites 16x16)
     275   02:8013                      
     276   02:8013                      ;	pop    ix
     277   02:8013                      ;	pop    iy
     278   02:8013                      ;	pop    af
     279   02:8013                      ;	pop    bc
     280   02:8013                      ;	pop    de
     281   02:8013                      ;	pop    hl
     282   02:8013                      ;	ex     af,af'
     283   02:8013                      ;	exx
     284   02:8013                      ;	pop    af
     285   02:8013                      ;	pop    bc
     286   02:8013                      ;	pop    de
     287   02:8013                      ;	pop    hl
     288   02:8013                      ;	ei
     289   02:8013                      ;	ret
     290   02:8013                      
     291   02:8013                      
     292   02:8013                      ; ------------
     293   02:8013                      ; megarom header
     294   02:8013                      
     295   02:8013  (00)                	page 0
     296   00:4000                      	code page 0
     297   00:4000                      
     298   00:4000                      	org	04000h
     299   00:4000  41 42               	db	041h,042h
     300   00:4002  17 44               	dw	initmain
     301   00:4004                      	dz 	'TRI004'
     301   00:4004  54 52 49 30 30 34 00 
     302   00:400B  00 (5)              	ds	5
     303   00:4010                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     304   00:4010                      ;
     305   00:4010                      ; checkkbd: ckeck keyboard line
     306   00:4010                      ; in:  E = row
     307   00:4010                      ; out: L = bit pattern (1 = not pressed)
     308   00:4010                      ;
     309   00:4010                      ; row/bit|    7     6     5     4     3     2     1     0
     310   00:4010                      ; -------+--------------------------------------------------
     311   00:4010                      ;    0   |    7     6     5     4     3     2     1     0
     312   00:4010                      ;    1   |    ;     ]     [     \     =     -     9     8
     313   00:4010                      ;    2   |    B     A    ???    /     .     ,     '     `
     314   00:4010                      ;    3   |    J     I     H     G     F     E     D     C
     315   00:4010                      ;    4   |    R     Q     P     O     N     M     L     K
     316   00:4010                      ;    5   |    Z     Y     X     W     V     U     T     S
     317   00:4010                      ;    6   |   F3    F2    F1   CODE   CAP  GRAPH CTRL  SHIFT
     318   00:4010                      ;    7   |   RET   SEL   BS   STOP   TAB   ESC   F5    F4
     319   00:4010                      ;    8   |  RIGHT DOWN   UP   LEFT   DEL   INS  HOME  SPACE
     320   00:4010                      ;    9   |    4     3     2     1     0     /     +     *
     321   00:4010                      ;   10   |    .     ,     -     9     8     7     6     5
     322   00:4010                      ;   11   |                           NO          YES
     323   00:4010                      ;
     324   00:4010                      ;
     325   00:4010                      
     326   00:4010  (00:00A9)           i8255portb  equ 0a9h        ; keyboard column input
     327   00:4010  (00:00AA)           i8255portc  equ 0aah        ; leds, motor, cassette, kbd line
     328   00:4010                      
     329   00:4010                      checkkbd:
     330   00:4010  DB AA               	in  a,(i8255portc)
     331   00:4012  E6 F0               	and 011110000B          ; upper 4 bits contain info to preserve
     332   00:4014  B3                  	or  e
     333   00:4015  D3 AA               	out (i8255portc),a
     334   00:4017  DB A9               	in  a,(i8255portb)
     335   00:4019  6F                  	ld  l,a
     336   00:401A  C9                  	ret
     337   00:401B                      
     338   00:401B                      
     339   00:401B                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     340   00:401B                      ; vdp access
     341   00:401B                      
     342   00:401B  (00:F3DF)           _vdpReg equ 0xF3DF
     343   00:401B  (00:F3AE)           LINL40	equ 0xF3AE
     344   00:401B                      
     345   00:401B                      ; e = screen mode
     346   00:401B                      _scr2:
     347   00:401B  3A E0 F3            	ld	a,(_vdpReg+1)
     348   00:401E  F6 02               	or 2
     349   00:4020  32 E0 F3            	ld	(_vdpReg+1),a
     350   00:4023                      
     351   00:4023  3E 02               	ld	a,2
     352   00:4025  CD 5F 00            	call 0x005f
     353   00:4028                      
     354   00:4028  C9                  	ret
     355   00:4029                      
     356   00:4029                      ; set sprites
     357   00:4029                      
     358   00:4029                      set_sprites:
     359   00:4029                      	setvdpwvram 0x3800
     359   00:4029  F3                >     di
     359   00:402A                    >     _setvdpwvram value
     359   00:402A                    >     if (value & 0xFF)
     359   00:402A                    ~         ld  a,value & 0xFF
     359   00:402A                    ~     else
     359   00:402A  AF                >         xor a
     359   00:402B                    >     endif
     359   00:402B  D3 99             >     out (0x99),a
     359   00:402D  3E 78             >     ld  a,0x40 + (value/256)
     359   00:402F  D3 99             >     out (0x99),a
     359   00:4031  FB                >     ei
     360   00:4032  21 00 A0            	ld	hl,test_spt
     361   00:4035  3E 05               	ld	a,:test_spt
     362   00:4037  CD 52 40            	call	write_256
     363   00:403A  76                  	halt
     364   00:403B                      	setvdpwvram 0x1B00
     364   00:403B  F3                >     di
     364   00:403C                    >     _setvdpwvram value
     364   00:403C                    >     if (value & 0xFF)
     364   00:403C                    ~         ld  a,value & 0xFF
     364   00:403C                    ~     else
     364   00:403C  AF                >         xor a
     364   00:403D                    >     endif
     364   00:403D  D3 99             >     out (0x99),a
     364   00:403F  3E 5B             >     ld  a,0x40 + (value/256)
     364   00:4041  D3 99             >     out (0x99),a
     364   00:4043  FB                >     ei
     365   00:4044  21 50 AF            	ld	hl,test_sat
     366   00:4047  3E 05               	ld	a,:test_sat
     367   00:4049  32 00 B0            	ld	(_bank4),a
     368   00:404C  01 98 80            	ld	bc,0x8098
     369   00:404F  ED B3               	otir
     370   00:4051  C9                  	ret
     371   00:4052                      
     372   00:4052                      write_256:
     373   00:4052  32 00 B0            	ld	(_bank4),a
     374   00:4055  01 98 00            	ld	bc,0x0098
     375   00:4058  3E 08               	ld	a,8
     376   00:405A  ED A3               1:	outi
     377   00:405C  C2 5A 40            	jp nz,1b
     378   00:405F  3D                  	dec	a
     379   00:4060  C2 5A 40            	jp nz,1b
     380   00:4063  C9                  	ret
     381   00:4064                      
     382   00:4064                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     383   00:4064                      ;	Initialise the tiles common to all banks
     384   00:4064                      ;	Common tiles are stored only once in a separate bank
     385   00:4064                      ;
     386   00:4064                      initcommontiles:
     387   00:4064  3E 04               	ld	a,:common_pattern
     388   00:4066  32 00 B0            	ld (_bank4),a
     389   00:4069  21 00 A0            	ld	hl,common_pattern
     390   00:406C  3E 9F               	ld	a,CommonTiles
     391   00:406E  11 00 48            	ld	de,0x0800 + 4000h
     392   00:4071  CD 77 41            	call write_2k
     393   00:4074                      
     394   00:4074  21 00 A0            	ld	hl,common_pattern
     395   00:4077  3E 9F               	ld	a,CommonTiles
     396   00:4079  11 00 50            	ld	de,0x1000 + 4000h
     397   00:407C  CD 77 41            	call write_2k
     398   00:407F                      
     399   00:407F  21 00 A0            	ld	hl,common_pattern
     400   00:4082  3E 9F               	ld	a,CommonTiles
     401   00:4084  11 00 68            	ld	de,0x2800 + 4000h
     402   00:4087  CD 77 41            	call write_2k
     403   00:408A                      
     404   00:408A  21 00 A0            	ld	hl,common_pattern
     405   00:408D  3E 9F               	ld	a,CommonTiles
     406   00:408F  11 00 70            	ld	de,0x3000 + 4000h
     407   00:4092  CD 77 41            	call write_2k
     408   00:4095                      
     409   00:4095  3E 04               	ld	a,:common_color
     410   00:4097  32 00 B0            	ld (_bank4),a
     411   00:409A  21 F8 A4            	ld	hl,common_color
     412   00:409D  3E 9F               	ld	a,CommonTiles
     413   00:409F  11 00 60            	ld	de,0x2000 + 4000h
     414   00:40A2  CD 77 41            	call write_2k
     415   00:40A5  21 F8 A4            	ld	hl,common_color
     416   00:40A8  3E 9F               	ld	a,CommonTiles
     417   00:40AA  11 00 40            	ld	de,0x0000 + 4000h
     418   00:40AD  CD 77 41            	call write_2k
     419   00:40B0  C9                  	ret
     420   00:40B1                      
     421   00:40B1                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     422   00:40B1                      ;	load tile sets: only differences are loaded
     423   00:40B1                      
     424   00:40B1                      setvramp:
     425   00:40B1  3A 09 E0            	ld	a,(vpage)
     426   00:40B4  A7                  	and	a
     427   00:40B5  CA BB 40            	jp	z,setvramp1	;	PGT at	0x0800/0x1000,	PCT at 0x0800
     428   00:40B8  C3 EE 40            	jp	setvramp0	;	PGT at	0x2800/0x3000,	PCT at 0x0000
     429   00:40BB                      
     430   00:40BB                      setvramp1:			;	PGT at	0x0800/0x1000,	PGT at 0x2000
     431   00:40BB  CD 21 41            	call getbank	;->a
     432   00:40BE  32 00 B0            	ld (_bank4),a
     433   00:40C1  CD 3B 41            	call getsize	;->a
     434   00:40C4  CD 2D 41            	call getaddr	;->hl
     435   00:40C7  11 F8 4C            	ld	de,0x0800 + 8*CommonTiles + 4000h
     436   00:40CA  CD 77 41            	call write_2k
     437   00:40CD                      
     438   00:40CD  CD 3B 41            	call getsize	;->a
     439   00:40D0  CD 2D 41            	call getaddr	;->hl
     440   00:40D3  11 F8 54            	ld	de,0x1000 + 8*CommonTiles + 4000h
     441   00:40D6  CD 77 41            	call write_2k
     442   00:40D9                      
     443   00:40D9  CD 21 41            	call getbank	;->a
     444   00:40DC  C6 04               	add	a,4			; colorbank = tilebank+4
     445   00:40DE  32 00 B0            	ld (_bank4),a
     446   00:40E1  CD 3B 41            	call getsize	;->a
     447   00:40E4  CD 2D 41            	call getaddr	;->hl
     448   00:40E7  11 F8 64            	ld	de,0x2000 + 8*CommonTiles + 4000h
     449   00:40EA  CD 77 41            	call write_2k
     450   00:40ED  C9                  	ret
     451   00:40EE                      
     452   00:40EE                      setvramp0:			;	PGT at	0x2800/0x3000,	PGT at 0x0000
     453   00:40EE  CD 21 41            	call getbank	;->a
     454   00:40F1  32 00 B0            	ld (_bank4),a
     455   00:40F4  CD 3B 41            	call getsize	;->a
     456   00:40F7  CD 2D 41            	call getaddr	;->hl
     457   00:40FA  11 F8 6C            	ld	de,0x2800 + 8*CommonTiles + 4000h
     458   00:40FD  CD 77 41            	call write_2k
     459   00:4100                      
     460   00:4100  CD 3B 41            	call getsize	;->a
     461   00:4103  CD 2D 41            	call getaddr	;->hl
     462   00:4106  11 F8 74            	ld	de,0x3000 + 8*CommonTiles + 4000h
     463   00:4109  CD 77 41            	call write_2k
     464   00:410C                      
     465   00:410C  CD 21 41            	call getbank	;->a
     466   00:410F  C6 04               	add	a,4			; colorbank = tilebank+4
     467   00:4111  32 00 B0            	ld (_bank4),a
     468   00:4114  CD 3B 41            	call getsize	;->a
     469   00:4117  CD 2D 41            	call getaddr	;->hl
     470   00:411A  11 F8 44            	ld	de,0x0000 + 8*CommonTiles + 4000h
     471   00:411D  CD 77 41            	call write_2k
     472   00:4120  C9                  	ret
     473   00:4121                      
     474   00:4121                      getbank:
     475   00:4121  ED 5B 08 E0         	ld	de,(phase)
     476   00:4125  21 47 41            	ld	hl,tilebank
     477   00:4128  16 00               	ld	d,0
     478   00:412A  19                  	add	hl,de
     479   00:412B  7E                  	ld	a,(hl)
     480   00:412C  C9                  	ret
     481   00:412D                      getaddr:
     482   00:412D  ED 5B 08 E0         	ld	de,(phase)
     483   00:4131  21 67 41            	ld	hl,tileaddress
     484   00:4134  16 00               	ld	d,0
     485   00:4136  19                  	add	hl,de
     486   00:4137  66                  	ld	h,(hl)
     487   00:4138  2E 00               	ld	l,0
     488   00:413A  C9                  	ret
     489   00:413B                      getsize:
     490   00:413B  ED 5B 08 E0         	ld	de,(phase)
     491   00:413F  21 57 41            	ld	hl,tilesize
     492   00:4142  16 00               	ld	d,0
     493   00:4144  19                  	add	hl,de
     494   00:4145  7E                  	ld	a,(hl)
     495   00:4146  C9                  	ret
     496   00:4147                      
     497   00:4147                      
     498   00:4147                      	;	patternsxy
     499   00:4147                      tilebank:
     500   00:4147  08 08 08 08         	db	:patterns11_13_15_17,:patterns11_13_15_17,:patterns11_13_15_17,:patterns11_13_15_17
     501   00:414B  09 09 09 09         	db	:patterns31_33_35_37,:patterns31_33_35_37,:patterns31_33_35_37,:patterns31_33_35_37
     502   00:414F  0A 0A 0A 0A         	db	:patterns51_53_55_57,:patterns51_53_55_57,:patterns51_53_55_57,:patterns51_53_55_57
     503   00:4153  0B 0B 0B 0B         	db	:patterns71_73_75_77,:patterns71_73_75_77,:patterns71_73_75_77,:patterns71_73_75_77
     504   00:4157                      tilesize:
     505   00:4157  1F 33 37 33         	db	TileSize11-CommonTiles,TileSize13-CommonTiles,TileSize15-CommonTiles,TileSize17-CommonTiles
     506   00:415B  2F 60 60 5E         	db	TileSize31-CommonTiles,TileSize33-CommonTiles,TileSize35-CommonTiles,TileSize37-CommonTiles
     507   00:415F  2D 60 61 61         	db	TileSize51-CommonTiles,TileSize53-CommonTiles,TileSize55-CommonTiles,TileSize57-CommonTiles
     508   00:4163  33 60 61 60         	db	TileSize71-CommonTiles,TileSize73-CommonTiles,TileSize75-CommonTiles,TileSize77-CommonTiles
     509   00:4167                      tileaddress:
     510   00:4167  A0 A8 B0 B8         	db	(patterns_base+0*2*1024)/256,(patterns_base+1*2*1024)/256,(patterns_base+2*2*1024)/256,(patterns_base+3*2*1024)/256
     511   00:416B  A0 A8 B0 B8         	db	(patterns_base+0*2*1024)/256,(patterns_base+1*2*1024)/256,(patterns_base+2*2*1024)/256,(patterns_base+3*2*1024)/256
     512   00:416F  A0 A8 B0 B8         	db	(patterns_base+0*2*1024)/256,(patterns_base+1*2*1024)/256,(patterns_base+2*2*1024)/256,(patterns_base+3*2*1024)/256
     513   00:4173  A0 A8 B0 B8         	db	(patterns_base+0*2*1024)/256,(patterns_base+1*2*1024)/256,(patterns_base+2*2*1024)/256,(patterns_base+3*2*1024)/256
     514   00:4177                      
     515   00:4177                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     516   00:4177                      ; write 2K while ints are active from hl to de
     517   00:4177                      ; in: de vram address
     518   00:4177                      ;     hl ram address
     519   00:4177                      ;	   a counter of 8 chunks of bytes 
     520   00:4177                      ;
     521   00:4177                      ; N outi per frame in vblank (NTSC) = 3579545 * ((27+24.5+3+3+13)/262.5*1/59.94)/18
     522   00:4177                      
     523   00:4177                      write_2k:
     524   00:4177  F3                  	di
     525   00:4178  0E 99               	ld	c,0x99
     526   00:417A  ED 59               	out (c),e
     527   00:417C  ED 51               	out (c),d	;c = 0x99, HL with write setup bit set
     528   00:417E                      
     529   00:417E  5F                  	ld	e,a
     530   00:417F  16 00               	ld	d,0
     531   00:4181  EB                  	ex	de,hl
     532   00:4182  29 29 29            [3]	add hl,hl
     533   00:4185  EB                  	ex	de,hl
     534   00:4186                      	
     535   00:4186  0D                  	dec	c
     536   00:4187                      	
     537   00:4187  7A                  	ld	a,d
     538   00:4188  A7                  	and	a
     539   00:4189  C4 99 41            	call	nz,3f
     540   00:418C  7B                  	ld	a,e
     541   00:418D  A7                  	and	a
     542   00:418E  CA 97 41            	jp	z,4f
     543   00:4191  43                  	ld	b,e
     544   00:4192  ED A3               2:	outi
     545   00:4194  C2 92 41            	jp	nz,2b
     546   00:4197  FB                  4:	ei
     547   00:4198  C9                  	ret
     548   00:4199                      	
     549   00:4199  06 00               3:	ld	b,0
     550   00:419B  ED A3               2:	outi
     551   00:419D  C2 9B 41            	jp	nz,2b
     552   00:41A0  15                  	dec	d
     553   00:41A1  C2 9B 41            	jp nz,2b	
     554   00:41A4  C9                  	ret
     555   00:41A5                      
     556   00:41A5                      
     557   00:41A5                      		
     558   00:41A5                      ; write_2k:
     559   00:41A5                      	; push hl
     560   00:41A5                      	; ex	de,hl
     561   00:41A5                      	; set	6,h
     562   00:41A5                      	; ld	c,0x99
     563   00:41A5                      	; ld	de,8
     564   00:41A5                      	; exx
     565   00:41A5                      	; pop	hl		; ram source in HL'
     566   00:41A5                      	; ld	c,0x98	; data port in c'
     567   00:41A5                      ; 2:	di
     568   00:41A5                      	; exx
     569   00:41A5                      	; out (c),l
     570   00:41A5                      	; out (c),h	;c = 0x99, HL with write setup bit set
     571   00:41A5                      	; add hl,de	;de = 8
     572   00:41A5                      	; exx
     573   00:41A5                      	; ld b,8
     574   00:41A5                      ; 1:	outi		;c' = 0x98
     575   00:41A5                      	; jp nz,1b
     576   00:41A5                      	; ei
     577   00:41A5                      	; dec a
     578   00:41A5                      	; jp nz,2b
     579   00:41A5                      	; ret
     580   00:41A5                      
     581   00:41A5                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     582   00:41A5                      ;	in xmap,ymap,phase
     583   00:41A5                      ;
     584   00:41A5                      plot_pnt:
     585   00:41A5  3E 07               	ld	a,:metavec
     586   00:41A7  32 00 B0            	ld	(_bank4),a
     587   00:41AA                      
     588   00:41AA  21 00 C0            	ld	hl,buffer	; meta map in ram
     589   00:41AD                      
     590   00:41AD  3A 05 E0            	ld	a,(ymap+1)	; ymap 8.8
     591   00:41B0  A7                  	and	a
     592   00:41B1  28 07               	jr	z,1f
     593   00:41B3  01 40 00            	ld	bc,LvlWidth
     594   00:41B6  09                  2:	add	hl,bc
     595   00:41B7  3D                  	dec a
     596   00:41B8  20 FC               	jr	nz,2b
     597   00:41BA                      1:
     598   00:41BA  3A 03 E0            	ld	a,(xmap+1)	; xmap 8.8
     599   00:41BD  5F                  	ld	e,a
     600   00:41BE  16 00               	ld	d,0
     601   00:41C0  19                  	add	hl,de
     602   00:41C1  EB                  	ex	de,hl		; DE = buffer + round(ymap)*LvlWidth+round(xmap)
     603   00:41C2                      
     604   00:41C2                      	setvdpwvram 0x1900
     604   00:41C2  F3                >     di
     604   00:41C3                    >     _setvdpwvram value
     604   00:41C3                    >     if (value & 0xFF)
     604   00:41C3                    ~         ld  a,value & 0xFF
     604   00:41C3                    ~     else
     604   00:41C3  AF                >         xor a
     604   00:41C4                    >     endif
     604   00:41C4  D3 99             >     out (0x99),a
     604   00:41C6  3E 59             >     ld  a,0x40 + (value/256)
     604   00:41C8  D3 99             >     out (0x99),a
     604   00:41CA  FB                >     ei
     605   00:41CB                      	
     606   00:41CB  0E 98               	ld  c,0x98
     607   00:41CD  DD 26 10            	ld  ixh,16
     608   00:41D0                      
     609   00:41D0  3A 08 E0            	ld	a,(phase)
     610   00:41D3  C6 A0               	add	a,metavec/256
     611   00:41D5                      	
     612   00:41D5                      1:	
     613   00:41D5  67                  	ld	h,a
     614   00:41D6  08                  	ex	af',af
     615   00:41D7                      	
     616   00:41D7  7B                  	ld  a,e
     617   00:41D8  C6 20               	add a,32
     618   00:41DA  D2 89 42            	jp  nc,.fast_loop
     619   00:41DD                      
     620   00:41DD                      	
     621   00:41DD                      	repeat 32
     622   00:41DD                    < 	ld	a,(de)
     623   00:41DD                    < 	ld	l,a
     624   00:41DD                    < 	outi         	; Send data pointed by HL to VDP port (reg.C preloaded)
     625   00:41DD                    < 	inc	de
     626   00:41DD                    < 	endrepeat
     626   00:41DD  1A 6F ED A3 13 1A 6F ED A3 13 1A 6F ED A3 13 1A 
     626   00:41ED  6F ED A3 13 1A 6F ED A3 13 1A 6F ED A3 13 1A 6F 
     626   00:41FD  ED A3 13 1A 6F ED A3 13 1A 6F ED A3 13 1A 6F ED 
     626   00:420D  A3 13 1A 6F ED A3 13 1A 6F ED A3 13 1A 6F ED A3 
     626   00:421D  13 1A 6F ED A3 13 1A 6F ED A3 13 1A 6F ED A3 13 
     626   00:422D  1A 6F ED A3 13 1A 6F ED A3 13 1A 6F ED A3 13 1A 
     626   00:423D  6F ED A3 13 1A 6F ED A3 13 1A 6F ED A3 13 1A 6F 
     626   00:424D  ED A3 13 1A 6F ED A3 13 1A 6F ED A3 13 1A 6F ED 
     626   00:425D  A3 13 1A 6F ED A3 13 1A 6F ED A3 13 1A 6F ED A3 
     626   00:426D  13 1A 6F ED A3 13 1A 6F ED A3 13 1A 6F ED A3 13 
     627   00:427D                      	
     628   00:427D  08                  	ex	af',af
     629   00:427E                      	
     630   00:427E  21 20 00            	ld	hl,LvlWidth-32
     631   00:4281  19                  	add	hl,de
     632   00:4282  EB                  	ex	de,hl
     633   00:4283                      
     634   00:4283  DD 25               	dec ixh
     635   00:4285  C2 D5 41            	jp nz,1b
     636   00:4288                      
     637   00:4288  C9                  	ret
     638   00:4289                      
     639   00:4289                      .fast_loop
     640   00:4289                      
     641   00:4289                      	repeat 32
     642   00:4289                    < 	ld	a,(de)
     643   00:4289                    < 	ld	l,a
     644   00:4289                    < 	outi         	; Send data pointed by HL to VDP port (reg.C preloaded)
     645   00:4289                    < 	inc	e			; save 32 INC DE 
     646   00:4289                    < 	endrepeat
     646   00:4289  1A 6F ED A3 1C 1A 6F ED A3 1C 1A 6F ED A3 1C 1A 
     646   00:4299  6F ED A3 1C 1A 6F ED A3 1C 1A 6F ED A3 1C 1A 6F 
     646   00:42A9  ED A3 1C 1A 6F ED A3 1C 1A 6F ED A3 1C 1A 6F ED 
     646   00:42B9  A3 1C 1A 6F ED A3 1C 1A 6F ED A3 1C 1A 6F ED A3 
     646   00:42C9  1C 1A 6F ED A3 1C 1A 6F ED A3 1C 1A 6F ED A3 1C 
     646   00:42D9  1A 6F ED A3 1C 1A 6F ED A3 1C 1A 6F ED A3 1C 1A 
     646   00:42E9  6F ED A3 1C 1A 6F ED A3 1C 1A 6F ED A3 1C 1A 6F 
     646   00:42F9  ED A3 1C 1A 6F ED A3 1C 1A 6F ED A3 1C 1A 6F ED 
     646   00:4309  A3 1C 1A 6F ED A3 1C 1A 6F ED A3 1C 1A 6F ED A3 
     646   00:4319  1C 1A 6F ED A3 1C 1A 6F ED A3 1C 1A 6F ED A3 1C 
     647   00:4329                      	
     648   00:4329  08                  	ex	af',af
     649   00:432A                      	
     650   00:432A  21 20 00            	ld	hl,LvlWidth-32
     651   00:432D  19                  	add	hl,de
     652   00:432E  EB                  	ex	de,hl
     653   00:432F                      
     654   00:432F  DD 25               	dec ixh
     655   00:4331  C2 D5 41            	jp nz,1b
     656   00:4334                      
     657   00:4334  C9                  	ret
     658   00:4335                      	
     659   00:4335                      	
     660   00:4335                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     661   00:4335                      
     662   00:4335                      ;          defb 0x02 ; Reg# 0 000000[M3][EV]
     663   00:4335                      ;          defb 0x62 ; Reg# 1 [4/16k][BLANK][IE][M1][M2]0[SIZE][MAG]
     664   00:4335                      ;          defb 0x06 ; Reg# 2 0000[NAME TABLE BASE ADDRESS]          = 1800h
     665   00:4335                      
     666   00:4335                      ;          defb 0x9F ; Reg# 3 [COLOR BASE ADDRESS]                   = 2000h ; hybrid mode for colors
     667   00:4335                      ;          defb 0xFF ; Reg# 3 [COLOR BASE ADDRESS]                   = 2000h ; regular mode for colors
     668   00:4335                      
     669   00:4335                      ;          defb 0x1F ; Reg# 3 [COLOR BASE ADDRESS]                   = 0000h ; hybrid mode for colors
     670   00:4335                      ;          defb 0x7F ; Reg# 3 [COLOR BASE ADDRESS]                   = 0000h ; regular mode for colors
     671   00:4335                      
     672   00:4335                      ;          defb 0x00 ; Reg# 4 00000[PATTERN GENERATOR BASE ADDRESS]  = 0000h ; hybrid mode for patterns
     673   00:4335                      ;          defb 0x03 ; Reg# 4 00000[PATTERN GENERATOR BASE ADDRESS]  = 0000h ; regular mode for patterns
     674   00:4335                      
     675   00:4335                      ;          defb 0x04 ; Reg# 4 00000[PATTERN GENERATOR BASE ADDRESS]  = 2000h ; hybrid mode for patterns
     676   00:4335                      ;          defb 0x07 ; Reg# 4 00000[PATTERN GENERATOR BASE ADDRESS]  = 2000h ; regular mode for patterns
     677   00:4335                      
     678   00:4335                      ;          defb 0x36 ; Reg# 5 0[SPRITE ATTRIBUTE TABLE BASE ADDRESS] = 1b00h
     679   00:4335                      ;          defb 0x07 ; Reg# 6 00000[SPRITE PTRN GNRTR BASE ADDRESS]  = 3800h
     680   00:4335                      ;          defb 0x01 ; Reg# 7 [TEXT COLOR 4bts][BACKDROP COLOR 4bts]
     681   00:4335                      
     682   00:4335                      
     683   00:4335                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     684   00:4335                      disp_page1:			; page 1 active
     685   00:4335                      	_setVdp 3,0x9F	; 	colours at 0x2000	(hybrid)
     685   00:4335  3E 9F             >     ld  a,value
     685   00:4337  D3 99             >     out (0x99),a
     685   00:4339  3E 83             >     ld  a,register + 0x80
     685   00:433B  D3 99             >     out (0x99),a
     686   00:433D                      	_setVdp 4,0x03	;	patterns at 0x0000	(regular: used 0x0800 0x1000)
     686   00:433D  3E 03             >     ld  a,value
     686   00:433F  D3 99             >     out (0x99),a
     686   00:4341  3E 84             >     ld  a,register + 0x80
     686   00:4343  D3 99             >     out (0x99),a
     687   00:4345  C9                  	ret
     688   00:4346                      
     689   00:4346                      disp_page0:			; page 0 active
     690   00:4346                      	_setVdp 3,0x1F	; 	colours at 0x0000	(hybrid)
     690   00:4346  3E 1F             >     ld  a,value
     690   00:4348  D3 99             >     out (0x99),a
     690   00:434A  3E 83             >     ld  a,register + 0x80
     690   00:434C  D3 99             >     out (0x99),a
     691   00:434E                      	_setVdp 4,0x07	;	patterns at 0x2000	(regular: used 0x2800 0x3000)
     691   00:434E  3E 07             >     ld  a,value
     691   00:4350  D3 99             >     out (0x99),a
     691   00:4352  3E 84             >     ld  a,register + 0x80
     691   00:4354  D3 99             >     out (0x99),a
     692   00:4356  C9                  	ret
     693   00:4357                      
     694   00:4357                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     695   00:4357                      ; set pages and subslot
     696   00:4357                      ;
     697   00:4357                      
     698   00:4357                      
     699   00:4357  (00:0024)           ENASLT:         equ     024h
     700   00:4357  (00:0138)           RSLREG:         equ     0138h
     701   00:4357  (00:FCC1)           EXPTBL:         equ     0FCC1h  ; Bios Slot / Expansion Slot
     702   00:4357                      
     703   00:4357                      ; -----------------------
     704   00:4357                      ; SEARCH_SLOTSET
     705   00:4357                      ; Posiciona en pagina 2
     706   00:4357                      ; Nuestro ROM.
     707   00:4357                      ; -----------------------
     708   00:4357                      
     709   00:4357                      search_slotset:
     710   00:4357  F3                  	di
     711   00:4358  CD 6F 43            	call    search_slot
     712   00:435B  CD 24 00            	call	ENASLT
     713   00:435E                      	
     714   00:435E                      	; now we have:
     715   00:435E                      	; page 0 	- bios
     716   00:435E                      	; page 1,2	- megarom mapper
     717   00:435E                      	; page 3	- RAM
     718   00:435E                      
     719   00:435E                      	; init megarom mapper
     720   00:435E  AF                  	xor	a
     721   00:435F  32 00 50            	ld	(_bank1),a
     722   00:4362  3C                  	inc	a
     723   00:4363  32 00 70            	ld	(_bank2),a
     724   00:4366  3C                  	inc	a
     725   00:4367  32 00 90            	ld	(_bank3),a
     726   00:436A  3C                  	inc	a
     727   00:436B  32 00 B0            	ld	(_bank4),a
     728   00:436E                      
     729   00:436E  C9                  	ret
     730   00:436F                      
     731   00:436F                      
     732   00:436F                      ; -----------------------
     733   00:436F                      ; SEARCH_SLOT
     734   00:436F                      ; Busca slot de nuestro rom
     735   00:436F                      ; -----------------------
     736   00:436F                      
     737   00:436F                      search_slot:
     738   00:436F  CD 38 01            	call    RSLREG
     739   00:4372  0F                  	rrca
     740   00:4373  0F                  	rrca
     741   00:4374  E6 03               	and     3
     742   00:4376  4F                  	ld      c,a
     743   00:4377  06 00               	ld      b,0
     744   00:4379  21 C1 FC            	ld      hl,EXPTBL
     745   00:437C  09                  	add     hl,bc
     746   00:437D  7E                  	ld      a,(hl)
     747   00:437E  E6 80               	and     080h
     748   00:4380  B1                  	or      c
     749   00:4381  4F                  	ld      c,a
     750   00:4382  23                  	inc     hl
     751   00:4383  23                  	inc     hl
     752   00:4384  23                  	inc     hl
     753   00:4385  23                  	inc     hl
     754   00:4386  7E                  	ld      a,(hl)
     755   00:4387  E6 0C               	and     0Ch
     756   00:4389  B1                  	or      c;
     757   00:438A  26 80               	ld      h,080h
     758   00:438C  32 00 E0            	ld      (slotvar),a
     759   00:438F  C9                  	ret
     760   00:4390                      
     761   00:4390                      ; ------------------------------
     762   00:4390                      ; SETROMPAGE0
     763   00:4390                      ; Posiciona nuestro cartucho en
     764   00:4390                      ; Pagina 0
     765   00:4390                      ; -----------------------------
     766   00:4390                      
     767   00:4390                      setrompage0:
     768   00:4390  3A 00 E0            	ld      a,(slotvar)
     769   00:4393  18 03               	jr      setslotpage0
     770   00:4395                      
     771   00:4395                      ; ------------------------------
     772   00:4395                      ; RECBIOS
     773   00:4395                      ; Posiciona la bios ROM
     774   00:4395                      ; -------------------------------
     775   00:4395                      recbios:
     776   00:4395  3A C1 FC            	ld      a,(EXPTBL)
     777   00:4398                      
     778   00:4398                      ; ---------------------------
     779   00:4398                      ; SETSLOTPAGE0
     780   00:4398                      ; Posiciona el slot pasado
     781   00:4398                      ; en pagina 0 del Z80
     782   00:4398                      ; A: Formato FxxxSSPP
     783   00:4398                      ; ----------------------------
     784   00:4398                      
     785   00:4398                      setslotpage0:
     786   00:4398  F3                  	di
     787   00:4399  47                  	ld      b,a                 ; B = Slot param in FxxxSSPP format
     788   00:439A                      
     789   00:439A  DB A8               	in      a,(0A8h)
     790   00:439C  E6 FC               	and     0xFC
     791   00:439E  57                  	ld      d,a                 ; D = Primary slot value
     792   00:439F                      
     793   00:439F  78                  	ld      a,b
     794   00:43A0                      
     795   00:43A0  E6 03               	and     3
     796   00:43A2  B2                  	or      d
     797   00:43A3  57                  	ld      d,a                 ; D = Final Value for primary slot
     798   00:43A4                      
     799   00:43A4                      	; Check if expanded
     800   00:43A4  78                  	ld      a,b
     801   00:43A5  CB 7F               	bit     7,a
     802   00:43A7  28 21               	jr      z,1f    ; Not Expanded
     803   00:43A9                      
     804   00:43A9  E6 03               	and     3
     805   00:43AB  0F                  	rrca
     806   00:43AC  0F                  	rrca
     807   00:43AD  E6 C0               	and     0xC0
     808   00:43AF  4F                  	ld      c,a
     809   00:43B0  7A                  	ld      a,d
     810   00:43B1  E6 3F               	and     0x3F
     811   00:43B3  B1                  	or      c
     812   00:43B4  4F                  	ld      c,a                 ; Primary slot value with main slot in page 3
     813   00:43B5                      
     814   00:43B5  78                  	ld      a,b
     815   00:43B6  E6 0C               	and     0x0C
     816   00:43B8  0F                  	rrca
     817   00:43B9  0F                  	rrca
     818   00:43BA  E6 03               	and     3
     819   00:43BC  47                  	ld      b,a                 ; B = Expanded slot in page 3
     820   00:43BD  79                  	ld      a,c
     821   00:43BE  D3 A8               	out     (0A8h),a            ; Slot : Main Slot, xx, xx, Main slot
     822   00:43C0  3A FF FF            	ld      a,(0FFFFh)
     823   00:43C3  2F                  	cpl
     824   00:43C4  E6 FC               	and     0xFC
     825   00:43C6  B0                  	or      b
     826   00:43C7  32 FF FF            	ld      (0FFFFh),a          ; Expanded slot selected
     827   00:43CA                      
     828   00:43CA                      1:
     829   00:43CA  7A                  	ld      a,d             ; A = Final value
     830   00:43CB  D3 A8               	out     (0A8h),a		; Slot Final. Ram, rom c, rom c, Main
     831   00:43CD  C9                  	ret
     832   00:43CE                      	
     833   00:43CE                      
     834   00:43CE                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     835   00:43CE                      ;
     836   00:43CE                      ;   load tile sets and sprites
     837   00:43CE                      vram_init:
     838   00:43CE                      	setvdpwvram 0x1B80              ; sprites in the scorebar
     838   00:43CE  F3                >     di
     838   00:43CF                    >     _setvdpwvram value
     838   00:43CF                    >     if (value & 0xFF)
     838   00:43CF  3E 80             >         ld  a,value & 0xFF
     838   00:43D1                    >     else
     838   00:43D1                    ~         xor a
     838   00:43D1                    ~     endif
     838   00:43D1  D3 99             >     out (0x99),a
     838   00:43D3  3E 5B             >     ld  a,0x40 + (value/256)
     838   00:43D5  D3 99             >     out (0x99),a
     838   00:43D7  FB                >     ei
     839   00:43D8  21 00 A4            	ld  hl,scorebar_sat
     840   00:43DB  3E 03               	ld	a,:scorebar_sat
     841   00:43DD  CD 52 40            	call    write_256
     842   00:43E0                      
     843   00:43E0                      	setvdpwvram 0x1C00
     843   00:43E0  F3                >     di
     843   00:43E1                    >     _setvdpwvram value
     843   00:43E1                    >     if (value & 0xFF)
     843   00:43E1                    ~         ld  a,value & 0xFF
     843   00:43E1                    ~     else
     843   00:43E1  AF                >         xor a
     843   00:43E2                    >     endif
     843   00:43E2  D3 99             >     out (0x99),a
     843   00:43E4  3E 5C             >     ld  a,0x40 + (value/256)
     843   00:43E6  D3 99             >     out (0x99),a
     843   00:43E8  FB                >     ei
     844   00:43E9  21 00 A0            	ld  hl,tileset					; dummy tile set from basic rom
     845   00:43EC  3E 03               	ld	a,:tileset
     846   00:43EE  CD 52 40            	call    write_256
     847   00:43F1                      
     848   00:43F1                      	setvdpwvram 0x1800				;   dummy PNT
     848   00:43F1  F3                >     di
     848   00:43F2                    >     _setvdpwvram value
     848   00:43F2                    >     if (value & 0xFF)
     848   00:43F2                    ~         ld  a,value & 0xFF
     848   00:43F2                    ~     else
     848   00:43F2  AF                >         xor a
     848   00:43F3                    >     endif
     848   00:43F3  D3 99             >     out (0x99),a
     848   00:43F5  3E 58             >     ld  a,0x40 + (value/256)
     848   00:43F7  D3 99             >     out (0x99),a
     848   00:43F9  FB                >     ei
     849   00:43FA  06 00               	ld	b,0
     850   00:43FC  3E 00               	ld	a,0
     851   00:43FE  D3 98               1:	out (0x98),a
     852   00:4400  04                  	inc	b
     853   00:4401  20 FB               	jr	nz,1b
     854   00:4403                      
     855   00:4403                      	setvdpwvram 0x1BD0
     855   00:4403  F3                >     di
     855   00:4404                    >     _setvdpwvram value
     855   00:4404                    >     if (value & 0xFF)
     855   00:4404  3E D0             >         ld  a,value & 0xFF
     855   00:4406                    >     else
     855   00:4406                    ~         xor a
     855   00:4406                    ~     endif
     855   00:4406  D3 99             >     out (0x99),a
     855   00:4408  3E 5B             >     ld  a,0x40 + (value/256)
     855   00:440A  D3 99             >     out (0x99),a
     855   00:440C  FB                >     ei
     856   00:440D  06 10               	ld	b,16				; 	dummy colors
     857   00:440F  3E 11               	ld	a,11h
     858   00:4411  D3 98               1:	out (0x98),a
     859   00:4413  05                  	dec	b
     860   00:4414  20 FB               	jr	nz,1b
     861   00:4416  C9                  	ret
     862   00:4417                      
     863   00:4417                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     864   00:4417                      ; ROM initialisation
     865   00:4417                      
     866   00:4417                      initmain:
     867   00:4417                      	
     868   00:4417  CD 1B 40            	call _scr2				; screen 2
     869   00:441A                      	
     870   00:441A  CD 57 43            	call 	search_slotset	; now the first 32KB of the megarom are active
     871   00:441D                      			
     872   00:441D                      	;call	setrompage0		; 48K of rom are active - bios is excluded
     873   00:441D                      	
     874   00:441D                      	_setVdp 7,0
     874   00:441D  3E 00             >     ld  a,value
     874   00:441F  D3 99             >     out (0x99),a
     874   00:4421  3E 87             >     ld  a,register + 0x80
     874   00:4423  D3 99             >     out (0x99),a
     875   00:4425  FB                  	ei
     876   00:4426  CD 29 40            	call	set_sprites
     877   00:4429  CD CE 43            	call 	vram_init		; set data in the top 3d of the screen
     878   00:442C                      	
     879   00:442C  CD 64 40            	call	initcommontiles		;	load common tiles
     880   00:442F                      	
     881   00:442F                      	; move meta map in ram
     882   00:442F  3E 06               	ld	a,:metamap
     883   00:4431  32 00 B0            	ld	(_bank4),a
     884   00:4434  01 C0 13            	ld	bc,LvlWidth*LvlHeigh
     885   00:4437  21 00 A0            	ld	hl,metamap
     886   00:443A  11 00 C0            	ld	de,buffer
     887   00:443D  ED B0               	ldir
     888   00:443F                      
     889   00:443F  21 00 80            	ld	hl,myisr
     890   00:4442  22 9B FD            	ld	(0xFD9A+1),hl
     891   00:4445  3E C3               	ld	a,0xC3
     892   00:4447  32 9A FD            	ld	(0xFD9A),a
     893   00:444A                      
     894   00:444A  21 00 00            	ld	hl,0
     895   00:444D  22 02 E0            	ld	(xmap),hl
     896   00:4450  22 04 E0            	ld	(ymap),hl
     897   00:4453  AF                  	xor a
     898   00:4454  32 06 E0            	ld	(dxmap),a
     899   00:4457  32 07 E0            	ld	(dymap),a
     900   00:445A  32 08 E0            	ld	(phase),a
     901   00:445D  3C                  	inc	a
     902   00:445E  32 09 E0            	ld	(vpage),a
     903   00:4461                      	
     904   00:4461                      
     905   00:4461                      mainloop:
     906   00:4461                      
     907   00:4461                      	; setVdp 7,2	
     908   00:4461  76                  	halt
     909   00:4462                      	; setVdp 7,8
     910   00:4462  CD 8E 44            	call	show_activepage
     911   00:4465  CD A5 41            	call    plot_pnt		;	use phase to plot the correct PNT
     912   00:4468                      	; setVdp 7,0
     913   00:4468                      	
     914   00:4468  CD 10 45            	call	sub_main		; 	compute new "phase"
     915   00:446B                      
     916   00:446B                      	; setVdp 7,2	
     917   00:446B  76                  	halt
     918   00:446C                      	setVdp 7,10
     918   00:446C  F3                >     di
     918   00:446D                    >     _setVdp register,value
     918   00:446D  3E 0A             >     ld  a,value
     918   00:446F  D3 99             >     out (0x99),a
     918   00:4471  3E 87             >     ld  a,register + 0x80
     918   00:4473  D3 99             >     out (0x99),a
     918   00:4475  FB                >     ei
     919   00:4476  CD B1 40            	call	setvramp		;	use phase to select the tileset loaded to page 1/0
     920   00:4479                      	setVdp 7,0
     920   00:4479  F3                >     di
     920   00:447A                    >     _setVdp register,value
     920   00:447A  3E 00             >     ld  a,value
     920   00:447C  D3 99             >     out (0x99),a
     920   00:447E  3E 87             >     ld  a,register + 0x80
     920   00:4480  D3 99             >     out (0x99),a
     920   00:4482  FB                >     ei
     921   00:4483                      		
     922   00:4483  3A 09 E0            	ld	a,(vpage)
     923   00:4486  EE 01               	xor 1				; 	swap page
     924   00:4488  32 09 E0            	ld	(vpage),a			
     925   00:448B                      		
     926   00:448B  C3 61 44            	jp 	mainloop
     927   00:448E                      	
     928   00:448E                      	
     929   00:448E                      show_activepage:	
     930   00:448E  3A 09 E0            	ld  a,(vpage)	
     931   00:4491  A7                  	and a
     932   00:4492  CA A8 44            	jp  z,.page0
     933   00:4495                      .page1:				; 	page 1 active
     934   00:4495  F3                  	di
     935   00:4496                      	_setVdp 3,0x9F	; 	PCT at 0x2000	(hybrid)
     935   00:4496  3E 9F             >     ld  a,value
     935   00:4498  D3 99             >     out (0x99),a
     935   00:449A  3E 83             >     ld  a,register + 0x80
     935   00:449C  D3 99             >     out (0x99),a
     936   00:449E                      	_setVdp 4,0x03	;	PGT at 0x0000	(regular: used 0x0800 0x1000)
     936   00:449E  3E 03             >     ld  a,value
     936   00:44A0  D3 99             >     out (0x99),a
     936   00:44A2  3E 84             >     ld  a,register + 0x80
     936   00:44A4  D3 99             >     out (0x99),a
     937   00:44A6  FB                  	ei
     938   00:44A7  C9                  	ret
     939   00:44A8                      .page0:				; 	page 0 active
     940   00:44A8  F3                  	di
     941   00:44A9                      	_setVdp 3,0x1F	; 	PCT at 0x0000	(hybrid)
     941   00:44A9  3E 1F             >     ld  a,value
     941   00:44AB  D3 99             >     out (0x99),a
     941   00:44AD  3E 83             >     ld  a,register + 0x80
     941   00:44AF  D3 99             >     out (0x99),a
     942   00:44B1                      	_setVdp 4,0x07	;	PGT at 0x2000	(regular: used 0x2800 0x3000)
     942   00:44B1  3E 07             >     ld  a,value
     942   00:44B3  D3 99             >     out (0x99),a
     942   00:44B5  3E 84             >     ld  a,register + 0x80
     942   00:44B7  D3 99             >     out (0x99),a
     943   00:44B9  FB                  	ei
     944   00:44BA  C9                  	ret
     945   00:44BB                      	
     946   00:44BB                      dxdycontrol:
     947   00:44BB  7D                  	ld  a,l
     948   00:44BC  E6 80               	and 0x80    ; right
     949   00:44BE  20 0C               	jr  nz,1f
     950   00:44C0  3A 06 E0            	ld  a,(dxmap)
     951   00:44C3  FE 80               	cp  maxspeed        ; MAX SPEED
     952   00:44C5  28 05               	jr  z,1f
     953   00:44C7  C6 01               	add a,maxspeedstep
     954   00:44C9  32 06 E0            	ld  (dxmap),a
     955   00:44CC                      1:
     956   00:44CC  7D                  	ld  a,l
     957   00:44CD  E6 10               	and 0x10    ; left
     958   00:44CF  20 0C               	jr  nz,1f
     959   00:44D1  3A 06 E0            	ld  a,(dxmap)
     960   00:44D4  FE 80               	cp  -maxspeed       ; MAX SPEED
     961   00:44D6  28 05               	jr  z,1f
     962   00:44D8  C6 FF               	add a,-maxspeedstep
     963   00:44DA  32 06 E0            	ld  (dxmap),a
     964   00:44DD                      1:
     965   00:44DD                      	; y position
     966   00:44DD  7D                  	ld  a,l
     967   00:44DE  E6 20               	and 0x20    ; up
     968   00:44E0  20 0C               	jr  nz,1f
     969   00:44E2  3A 07 E0            	ld  a,(dymap)
     970   00:44E5  FE 80               	cp  -maxspeed        ; MAX SPEED
     971   00:44E7  28 05               	jr  z,1f
     972   00:44E9  C6 FF               	add a,-maxspeedstep
     973   00:44EB  32 07 E0            	ld  (dymap),a
     974   00:44EE                      1:
     975   00:44EE  7D                  	ld  a,l
     976   00:44EF  E6 40               	and 0x40    ; down
     977   00:44F1  20 0C               	jr  nz,1f
     978   00:44F3  3A 07 E0            	ld  a,(dymap)
     979   00:44F6  FE 80               	cp  maxspeed       ; MAX SPEED
     980   00:44F8  28 05               	jr  z,1f
     981   00:44FA  C6 01               	add a,maxspeedstep
     982   00:44FC  32 07 E0            	ld  (dymap),a
     983   00:44FF                      1:
     984   00:44FF  C9                  	ret
     985   00:4500                      
     986   00:4500                      stopx:
     987   00:4500  AF                  	xor	a
     988   00:4501  32 06 E0            	ld  (dxmap),a
     989   00:4504  21 00 00            	ld	hl,0
     990   00:4507  C9                  	ret
     991   00:4508                      stopy:
     992   00:4508  AF                  	xor	a
     993   00:4509  32 07 E0            	ld  (dymap),a
     994   00:450C  21 00 00            	ld	hl,0
     995   00:450F  C9                  	ret
     996   00:4510                      
     997   00:4510                      sub_main:
     998   00:4510                      	; x speed control
     999   00:4510  1E 08               	ld  e,8
    1000   00:4512  CD 10 40            	call    checkkbd
    1001   00:4515  CD BB 44            	call	dxdycontrol
    1002   00:4518                      
    1003   00:4518  ED 5B 02 E0         	ld  de,(xmap)		; FP 4.4
    1004   00:451C  3A 06 E0            	ld  a,(dxmap)
    1005   00:451F  6F                  	ld  l,a
    1006   00:4520  87                  	add a,a
    1007   00:4521  9F                  	sbc a,a
    1008   00:4522  67                  	ld  h,a
    1009   00:4523  29 29 29 29         [4]	add	hl,hl
    1010   00:4527  A7                  	and a
    1011   00:4528  ED 5A               	adc hl,de
    1012   00:452A  FC 00 45            	call	m,stopx
    1013   00:452D  11 C0 1F            	ld	de,(LvlWidth-32)*256-64
    1014   00:4530  A7                  	and a
    1015   00:4531  ED 52               	sbc	hl,de
    1016   00:4533  F4 00 45            	call	p,stopx
    1017   00:4536  19                  	add	hl,de
    1018   00:4537  22 02 E0            	ld  (xmap),hl
    1019   00:453A                      
    1020   00:453A  ED 5B 04 E0         	ld  de,(ymap)		; FP 4.4
    1021   00:453E  3A 07 E0            	ld  a,(dymap)
    1022   00:4541  6F                  	ld  l,a
    1023   00:4542  87                  	add a,a
    1024   00:4543  9F                  	sbc a,a
    1025   00:4544  67                  	ld  h,a
    1026   00:4545  29 29 29 29         [4]	add	hl,hl
    1027   00:4549  A7                  	and	a
    1028   00:454A  ED 5A               	adc hl,de
    1029   00:454C  FC 08 45            	call	m,stopy
    1030   00:454F  11 C0 3E            	ld	de,(LvlHeigh-16)*256-64
    1031   00:4552  A7                  	and a
    1032   00:4553  ED 52               	sbc	hl,de
    1033   00:4555  F4 08 45            	call	p,stopy
    1034   00:4558  19                  	add	hl,de
    1035   00:4559  22 04 E0            	ld  (ymap),hl
    1036   00:455C                      
    1037   00:455C                      
    1038   00:455C  3A 02 E0            	ld	a,(xmap)	; xmap 8.8
    1039   00:455F  07 07               [2]	rlca
    1040   00:4561  E6 03               	and		%00000011
    1041   00:4563  47                  	ld	b,a
    1042   00:4564  3A 04 E0            	ld	a,(ymap)	; ymap 8.8
    1043   00:4567  07 07 07 07         [4]	rlca
    1044   00:456B  E6 0C               	and		%00001100
    1045   00:456D  B0                  	or	b
    1046   00:456E  32 08 E0            	ld	(phase),a
    1047   00:4571  C9                  	ret
    1048   00:4572                      
    1049   00:4572                      
    1050   00:4572                      
    1051   00:4572                      

    LABELS
-------------------------------------------------
00:00000040   LvlWidth
00:0000004F   LvlHeigh
00:0000009F   CommonTiles
00:000000BE   TileSize11
00:000000D2   TileSize13
00:000000D6   TileSize15
00:000000D2   TileSize17
00:000000CE   TileSize31
00:000000FF   TileSize33
00:000000FF   TileSize35
00:000000FD   TileSize37
00:000000CC   TileSize51
00:000000FF   TileSize53
00:00000100   TileSize55
00:00000100   TileSize57
00:000000D2   TileSize71
00:000000FF   TileSize73
00:00000100   TileSize75
00:000000FF   TileSize77
03:0000A000   tileset
03:0000A400   scorebar_sat
04:0000A000   common_pattern
04:0000A4F8   common_color
05:0000A000   test_spt
05:0000AF50   test_sat
05:00000080 S counter
06:0000A000   metamap
07:0000A000   metavec
08:0000A000   patterns_base
08:0000A000   patterns11_13_15_17
09:0000A000   patterns31_33_35_37
0A:0000A000   patterns51_53_55_57
0B:0000A000   patterns71_73_75_77
0C:0000A000 X colors_base
0C:0000A000 X colors11_13_15_17
0D:0000A000 X colors31_33_35_37
0E:0000A000 X colors51_53_55_57
0F:0000A000 X colors71_73_75_77
0F:00005000   _bank1
0F:00007000   _bank2
0F:00009000   _bank3
0F:0000B000   _bank4
0F:00000080   maxspeed
0F:00000001   maxspeedstep
0F:0000C000   buffer
0F:0000E000   slotvar
0F:0000E001 X slotram
0F:0000E002   xmap
0F:0000E004   ymap
0F:0000E006   dxmap
0F:0000E007   dymap
0F:0000E008   phase
0F:0000E009   vpage
02:00008000   myisr
00:000000A9   i8255portb
00:000000AA   i8255portc
00:00004010   checkkbd
00:0000F3DF   _vdpReg
00:0000F3AE X LINL40
00:0000401B   _scr2
00:00004029   set_sprites
00:00004052   write_256
00:00004064   initcommontiles
00:000040B1   setvramp
00:000040BB   setvramp1
00:000040EE   setvramp0
00:00004121   getbank
00:0000412D   getaddr
00:0000413B   getsize
00:00004147   tilebank
00:00004157   tilesize
00:00004167   tileaddress
00:00004177   write_2k
00:000041A5   plot_pnt
00:00004289   plot_pnt.fast_loop
00:00004335 X disp_page1
00:00004346 X disp_page0
00:00000024   ENASLT
00:00000138   RSLREG
00:0000FCC1   EXPTBL
00:00004357   search_slotset
00:0000436F   search_slot
00:00004390 X setrompage0
00:00004395 X recbios
00:00004398   setslotpage0
00:000043CE   vram_init
00:00004417   initmain
00:00004461   mainloop
00:0000448E   show_activepage
00:00004495 X show_activepage.page1
00:000044A8   show_activepage.page0
00:000044BB   dxdycontrol
00:00004500   stopx
00:00004508   stopy
00:00004510   sub_main


 Output: src\main128.out
-------------------------------------------------

 Page: 00
  Org: 00004000  Size: *  Used: 00000000

    No output

 Output: Scrll8way128.rom
-------------------------------------------------

 Page: 00
  Org: 00004000  Size: 00002000  Used: 00000572

   Address   Length Align   Label
   00004000    1394         checkkbd
   00004572    6798       <empty>

 Page: 01
  Org: 00006000  Size: 00002000  Used: 00000000

   00006000    8192       <empty>

 Page: 02
  Org: 00008000  Size: 00002000  Used: 00000013

   Address   Length Align   Label
   00008000      19         myisr
   00008013    8173       <empty>

 Page: 03
  Org: 0000A000  Size: 00002000  Used: 00000415

   Address   Length Align   Label
   0000A000    1045         tileset
   0000A415    7147       <empty>

 Page: 04
  Org: 0000A000  Size: 00002000  Used: 000009F0

   Address   Length Align   Label
   0000A000    2544         common_pattern
   0000A9F0    5648       <empty>

 Page: 05
  Org: 0000A000  Size: 00002000  Used: 00000FD0

   Address   Length Align   Label
   0000A000    4048         test_spt
   0000AFD0    4144       <empty>

 Page: 06
  Org: 0000A000  Size: 00002000  Used: 000013C0

   Address   Length Align   Label
   0000A000    5056         metamap
   0000B3C0    3136       <empty>

 Page: 07
  Org: 0000A000  Size: 00002000  Used: 00001000

   Address   Length Align   Label
   0000A000    4096         metavec
   0000B000    4096       <empty>

 Page: 08
  Org: 0000A000  Size: 00002000  Used: 00001B08

   Address   Length Align   Label
   0000A000    6920         patterns_base
   0000BB08    1272       <empty>

 Page: 09
  Org: 0000A000  Size: 00002000  Used: 00001B08

   Address   Length Align   Label
   0000A000    6920         patterns31_33_35_37
   0000BB08    1272       <empty>

 Page: 0A
  Org: 0000A000  Size: 00002000  Used: 00001B08

   Address   Length Align   Label
   0000A000    6920         patterns51_53_55_57
   0000BB08    1272       <empty>

 Page: 0B
  Org: 0000A000  Size: 00002000  Used: 00001B08

   Address   Length Align   Label
   0000A000    6920         patterns71_73_75_77
   0000BB08    1272       <empty>

 Page: 0C
  Org: 0000A000  Size: 00002000  Used: 00001B08

   Address   Length Align   Label
   0000A000    6920         colors_base
   0000BB08    1272       <empty>

 Page: 0D
  Org: 0000A000  Size: 00002000  Used: 00001B08

   Address   Length Align   Label
   0000A000    6920         colors31_33_35_37
   0000BB08    1272       <empty>

 Page: 0E
  Org: 0000A000  Size: 00002000  Used: 00001B08

   Address   Length Align   Label
   0000A000    6920         colors51_53_55_57
   0000BB08    1272       <empty>

 Page: 0F
  Org: 0000A000  Size: 00002000  Used: 00001B08

   Address   Length Align   Label
   0000A000    6920         colors71_73_75_77
   0000BB08    1272       <empty>
