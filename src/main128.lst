Sjasm Z80 Assembler v0.42b8 - www.xl2s.tk             [2019.03.02 - 00:02:12]

src\main128.asm
Errors: 0

       1   00:0000                      
       2   00:0000                      
       3   00:0000                      	incdir data_bin/
       4   00:0000                      
       5   00:0000                      	include parameters.asm
       1.  00:0000  (00:0060)           LvlWidth:  equ 96
       2.  00:0000  (00:0030)           LvlHeigh:  equ 48
       3.  00:0000  (00:00CA)           CommonTiles:  equ 202
       4.  00:0000  (00:00E8)           TileSize11:  equ 232
       5.  00:0000  (00:00F9)           TileSize13:  equ 249
       6.  00:0000  (00:00F8)           TileSize15:  equ 248
       7.  00:0000  (00:00F6)           TileSize17:  equ 246
       8.  00:0000  (00:00FA)           TileSize31:  equ 250
       9.  00:0000  (00:00FF)           TileSize33:  equ 255
      10.  00:0000  (00:00FF)           TileSize35:  equ 255
      11.  00:0000  (00:00FF)           TileSize37:  equ 255
      12.  00:0000  (00:00FF)           TileSize51:  equ 255
      13.  00:0000  (00:00FF)           TileSize53:  equ 255
      14.  00:0000  (00:00FF)           TileSize55:  equ 255
      15.  00:0000  (00:00FF)           TileSize57:  equ 255
      16.  00:0000  (00:00F5)           TileSize71:  equ 245
      17.  00:0000  (00:00FF)           TileSize73:  equ 255
      18.  00:0000  (00:0100)           TileSize75:  equ 256
      19.  00:0000  (00:0100)           TileSize77:  equ 256
       6   00:0000                      
       7   00:0000                      	output Scrll8way128.rom
       8   00:0000                      
       9   00:0000                      	defpage	0,0x4000, 0x2000		; page 0 contains main code + far call routines
      10   00:0000                      	defpage 1,0x6000, 0x2000		; static code
      11   00:0000                      	defpage	2,0x8000, 0x2000		; static code - ISR code
      12   00:0000                      	
      13   00:0000                      	defpage	3,0xA000, 0x2000		; 
      14   00:0000                      	defpage	4,0xA000, 0x2000		; common patterns and colors
      15   00:0000                      	
      16   00:0000                      	defpage	5,0xA000, 0x2000		; sprites
      17   00:0000                      	defpage	6,0xA000, 0x2000		; meta map
      18   00:0000                      	defpage	7,0xA000, 0x2000		; metavec
      19   00:0000                      
      20   00:0000                      	defpage	 8,0xA000, 0x2000		; patterns_base
      21   00:0000                      	defpage	 9,0xA000, 0x2000		; patterns_base
      22   00:0000                      	defpage	10,0xA000, 0x2000		; patterns_base
      23   00:0000                      	defpage	11,0xA000, 0x2000		; patterns_base
      24   00:0000                      	defpage	12,0xA000, 0x2000		; colors_base
      25   00:0000                      	defpage	13,0xA000, 0x2000		; colors_base
      26   00:0000                      	defpage	14,0xA000, 0x2000		; colors_base
      27   00:0000                      	defpage	15,0xA000, 0x2000		; colors_base
      28   00:0000                      
      29   00:0000                      
      30   00:0000                      
      31   00:0000                      ; *** tile set data in rom ***
      32   00:0000  (03)                	page 3
      33   03:A000                      tileset:
      34   03:A000  (0400)              	incbin tileset.bin
      35   03:A400                      	
      36   03:A400                      	; place sprites in the score bar
      37   03:A400                      scorebar_sat:
      38   03:A400                      	repeat  4
      39   03:A400                    < 	db  5*8
      40   03:A400                    < 	db  @# * 16
      41   03:A400                    < 	db  32*4
      42   03:A400                    < 	db  0
      43   03:A400                    < 	endrepeat
      43   03:A400  28 00 80 00 28 10 80 00 28 20 80 00 28 30 80 00 
      44   03:A410  36                  	db  5*8+14
      45   03:A411  40                  	db  4*16
      46   03:A412  80                  	db  32*4
      47   03:A413  00                  	db  0
      48   03:A414  D0                  	db	0xd0
      49   03:A415                      	
      50   03:A415  (04)                	page 4
      51   04:A000                      common_pattern:
      52   04:A000  (0650)              	incbin testpat.bin,0,CommonTiles*8
      53   04:A650                      common_color:
      54   04:A650  (0650)              	incbin testcol.bin,0,CommonTiles*8
      55   04:ACA0                      
      56   04:ACA0  (05)                	page 5
      57   05:A000                      test_spt:
      58   05:A000  (0F50)              	incbin spt.bin
      59   05:AF50                      ;	place 32 sprites
      60   05:AF50                      test_sat:
      61   05:AF50  (05:0000)           counter:=0
      62   05:AF50                      	repeat	8
      63   05:AF50                    < 	repeat	4
      64   05:AF50                    < 	db	64 + @@# * 16
      65   05:AF50                    < 	db	48 +  @# * 32 + @@#*8
      66   05:AF50                    < 	db	6*4+(counter and %00001100)
      67   05:AF50                    < 	db	15
      68   05:AF50                    < counter:=counter+4
      69   05:AF50                    < 	endrepeat
      70   05:AF50                    < 	endrepeat
      70   05:AF50  40 30 18 0F 40 50 1C 0F 40 70 20 0F 40 90 24 0F 
      70   05:AF60  50 38 18 0F 50 58 1C 0F 50 78 20 0F 50 98 24 0F 
      70   05:AF70  60 40 18 0F 60 60 1C 0F 60 80 20 0F 60 A0 24 0F 
      70   05:AF80  70 48 18 0F 70 68 1C 0F 70 88 20 0F 70 A8 24 0F 
      70   05:AF90  80 50 18 0F 80 70 1C 0F 80 90 20 0F 80 B0 24 0F 
      70   05:AFA0  90 58 18 0F 90 78 1C 0F 90 98 20 0F 90 B8 24 0F 
      70   05:AFB0  A0 60 18 0F A0 80 1C 0F A0 A0 20 0F A0 C0 24 0F 
      70   05:AFC0  B0 68 18 0F B0 88 1C 0F B0 A8 20 0F B0 C8 24 0F 
      71   05:AFD0                      
      72   05:AFD0  (06)                	page 6
      73   06:A000                      metamap:
      74   06:A000  (1200)              	incbin metamap.bin
      75   06:B200                      
      76   06:B200  (07)                	page 7
      77   07:A000                      metavec:
      78   07:A000  (1000)              	incbin metavec.bin
      79   07:B000                      
      80   07:B000  (08)                	page 8
      81   08:A000                      patterns_base:
      82   08:A000                      patterns11_13_15_17:
      83   08:A000  (19B0)              	incbin testpat.bin,00*2*1024+CommonTiles*8,4*2*1024-CommonTiles*8
      84   08:B9B0  (09)                	page 9
      85   09:A000                      patterns31_33_35_37:
      86   09:A000  (19B0)              	incbin testpat.bin,04*2*1024+CommonTiles*8,8*1024-CommonTiles*8
      87   09:B9B0  (0A)                	page 10
      88   0A:A000                      patterns51_53_55_57:
      89   0A:A000  (19B0)              	incbin testpat.bin,08*2*1024+CommonTiles*8,8*1024-CommonTiles*8
      90   0A:B9B0  (0B)                	page 11
      91   0B:A000                      patterns71_73_75_77:
      92   0B:A000  (19B0)              	incbin testpat.bin,12*2*1024+CommonTiles*8,8*1024-CommonTiles*8
      93   0B:B9B0                      
      94   0B:B9B0  (0C)                	page 12
      95   0C:A000                      colors_base:
      96   0C:A000                      colors11_13_15_17:
      97   0C:A000  (19B0)              	incbin testcol.bin,00*2*1024+CommonTiles*8,4*2*1024-CommonTiles*8
      98   0C:B9B0  (0D)                	page 13
      99   0D:A000                      colors31_33_35_37:
     100   0D:A000  (19B0)              	incbin testcol.bin,04*2*1024+CommonTiles*8,8*1024-CommonTiles*8
     101   0D:B9B0  (0E)                	page 14
     102   0E:A000                      colors51_53_55_57:
     103   0E:A000  (19B0)              	incbin testcol.bin,08*2*1024+CommonTiles*8,8*1024-CommonTiles*8
     104   0E:B9B0  (0F)                	page 15
     105   0F:A000                      colors71_73_75_77:
     106   0F:A000  (19B0)              	incbin testcol.bin,12*2*1024+CommonTiles*8,8*1024-CommonTiles*8
     107   0F:B9B0                      
     108   0F:B9B0                      
     109   0F:B9B0                      
     110   0F:B9B0                      
     111   0F:B9B0                          macro _setVdp register,value       ; without DI/EI
     112   0F:B9B0                    <     ld  a,value
     113   0F:B9B0                    <     out (0x99),a
     114   0F:B9B0                    <     ld  a,register + 0x80
     115   0F:B9B0                    <     out (0x99),a
     116   0F:B9B0                    <     endmacro
     117   0F:B9B0                      
     118   0F:B9B0                          macro setVdp register,value       ; macro definition
     119   0F:B9B0                    <     di
     120   0F:B9B0                    <     _setVdp register,value
     121   0F:B9B0                    <     ei
     122   0F:B9B0                    <     endmacro
     123   0F:B9B0                      
     124   0F:B9B0                          macro _setvdpwvram value
     125   0F:B9B0                    <     if (value & 0xFF)
     126   0F:B9B0                    <         ld  a,value & 0xFF
     127   0F:B9B0                    <     else
     128   0F:B9B0                    <         xor a
     129   0F:B9B0                    <     endif
     130   0F:B9B0                    <     out (0x99),a
     131   0F:B9B0                    <     ld  a,0x40 + (value/256)
     132   0F:B9B0                    <     out (0x99),a
     133   0F:B9B0                    <     endmacro
     134   0F:B9B0                      
     135   0F:B9B0                          macro setvdpwvram value
     136   0F:B9B0                    <     di
     137   0F:B9B0                    <     _setvdpwvram value
     138   0F:B9B0                    <     ei
     139   0F:B9B0                    <     endmacro
     140   0F:B9B0                      	
     141   0F:B9B0                      ; -----------------------------
     142   0F:B9B0                      ; smooth scroller demo
     143   0F:B9B0                      ; Trilobyte 2014
     144   0F:B9B0                      ; ------------------------------
     145   0F:B9B0                      
     146   0F:B9B0                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     147   0F:B9B0                      ;
     148   0F:B9B0                      ;   Mapper Konami 5 (mapper +  scc)
     149   0F:B9B0                      ;
     150   0F:B9B0                      ; Bank 1: 4000h - 5FFFh
     151   0F:B9B0                      ; Bank 2: 6000h - 7FFFh
     152   0F:B9B0                      ; Bank 3: 8000h - 9FFFh
     153   0F:B9B0                      ; Bank 4: A000h - BFFFh
     154   0F:B9B0                      
     155   0F:B9B0                      ; Bank 1: 5000h - 57FFh (5000h used)
     156   0F:B9B0                      ; Bank 2: 7000h - 77FFh (7000h used)
     157   0F:B9B0                      ; Bank 3: 9000h - 97FFh (9000h used)
     158   0F:B9B0                      ; Bank 4: B000h - B7FFh (B000h used)
     159   0F:B9B0                      
     160   0F:B9B0                      
     161   0F:B9B0                      ; *** CONSTANTS ***
     162   0F:B9B0  (0F:5000)           _bank1			equ	0x5000
     163   0F:B9B0  (0F:7000)           _bank2			equ	0x7000
     164   0F:B9B0  (0F:9000)           _bank3			equ	0x9000
     165   0F:B9B0  (0F:B000)           _bank4			equ	0xB000
     166   0F:B9B0                      
     167   0F:B9B0                      ; -----------------------------
     168   0F:B9B0                      ; parameters
     169   0F:B9B0                      ;
     170   0F:B9B0                      
     171   0F:B9B0                      ;
     172   0F:B9B0  (0F:0080)           maxspeed:   	equ 8*16
     173   0F:B9B0  (0F:0001)           maxspeedstep:	equ	1
     174   0F:B9B0                      ;
     175   0F:B9B0                      ;minspeed:	equ	1		i.e. 	1/16
     176   0F:B9B0                      
     177   0F:B9B0                      ; ------------------------------
     178   0F:B9B0                      
     179   0F:B9B0                      ; *** RAM ***
     180   0F:B9B0                      
     181   0F:B9B0  (C000)              	map 0xc000
     182   0F:B9B0                      
     183   0F:B9B0  (0F:C000)           buffer:			#8*1024
     184   0F:B9B0                      
     185   0F:B9B0                      
     186   0F:B9B0  (0F:E000)           slotvar:		#1
     187   0F:B9B0  (0F:E001)           slotram:       	#1
     188   0F:B9B0                      
     189   0F:B9B0  (0F:E002)           xmap			#2		; FP 8.8
     190   0F:B9B0  (0F:E004)           ymap			#2		; FP 8.8
     191   0F:B9B0  (0F:E006)           dxmap           #1		; FP 4.4
     192   0F:B9B0  (0F:E007)           dymap           #1		; FP 4.4
     193   0F:B9B0                      
     194   0F:B9B0  (0F:E008)           phase			#1
     195   0F:B9B0  (0F:E009)           vpage			#1
     196   0F:B9B0                      
     197   0F:B9B0  (0000)              	endmap
     198   0F:B9B0                      
     199   0F:B9B0                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     200   0F:B9B0                      ; Interrupt service routine
     201   0F:B9B0                      ;
     202   0F:B9B0                      
     203   0F:B9B0  (02)                	page 2
     204   02:8000                      myisr:
     205   02:8000  F1                   	pop		af		; 	remove return address
     206   02:8001  DB 99               	in  a,(0x99)	; 	s0 reset
     207   02:8003  DD E1                	pop    ix
     208   02:8005  FD E1               	pop    iy
     209   02:8007  F1                  	pop    af
     210   02:8008  C1                  	pop    bc
     211   02:8009  D1                  	pop    de
     212   02:800A  E1                  	pop    hl
     213   02:800B  08                  	ex     af,af'
     214   02:800C  D9                  	exx
     215   02:800D  F1                  	pop    af
     216   02:800E  C1                  	pop    bc
     217   02:800F  D1                  	pop    de
     218   02:8010  E1                  	pop    hl
     219   02:8011  FB                  	ei
     220   02:8012  C9                  	ret
     221   02:8013                      	
     222   02:8013                      ;	push   hl
     223   02:8013                      ;	push   de
     224   02:8013                      ;	push   bc
     225   02:8013                      ;	push   af
     226   02:8013                      ;	exx
     227   02:8013                      ;	ex     af,af'
     228   02:8013                      ;	push   hl
     229   02:8013                      ;	push   de
     230   02:8013                      ;	push   bc
     231   02:8013                      ;	push   af
     232   02:8013                      ;	push   iy
     233   02:8013                      ;	push   ix
     234   02:8013                      	
     235   02:8013  F1                  	pop		af		; 	remove return address
     236   02:8014                      
     237   02:8014                      	_setVdp 0,0x00  ; 	screen 1
     237   02:8014  3E 00             >     ld  a,value
     237   02:8016  D3 99             >     out (0x99),a
     237   02:8018  3E 80             >     ld  a,register + 0x80
     237   02:801A  D3 99             >     out (0x99),a
     238   02:801C                      
     239   02:801C                      	_setVdp 4,0x03  ; 	PGT at 1800h (used from 0x1C00 to 0x1FFF, only 128 characters)
     239   02:801C  3E 03             >     ld  a,value
     239   02:801E  D3 99             >     out (0x99),a
     239   02:8020  3E 84             >     ld  a,register + 0x80
     239   02:8022  D3 99             >     out (0x99),a
     240   02:8024                      	_setVdp 3,0x6F  ; 	PCT at 1BC0h (used from 0x1BD0 to 0x1BDF, only 16 bytes)
     240   02:8024  3E 6F             >     ld  a,value
     240   02:8026  D3 99             >     out (0x99),a
     240   02:8028  3E 83             >     ld  a,register + 0x80
     240   02:802A  D3 99             >     out (0x99),a
     241   02:802C                      
     242   02:802C                      	_setVdp 5,0x37  ;   SAT at 1B80
     242   02:802C  3E 37             >     ld  a,value
     242   02:802E  D3 99             >     out (0x99),a
     242   02:8030  3E 85             >     ld  a,register + 0x80
     242   02:8032  D3 99             >     out (0x99),a
     243   02:8034                      	_setVdp 6,0x03  ;   SPT at 1800   (used from 0x1C00 to 0x1FFF  only 32 sprites 16x16)
     243   02:8034  3E 03             >     ld  a,value
     243   02:8036  D3 99             >     out (0x99),a
     243   02:8038  3E 86             >     ld  a,register + 0x80
     243   02:803A  D3 99             >     out (0x99),a
     244   02:803C                      
     245   02:803C  DB 99               	in  a,(0x99)	; 	s0 reset
     246   02:803E                      
     247   02:803E                      	; _setVdp 7,8  	; 	
     248   02:803E                      	; call    _plot_pnt
     249   02:803E                      	; _setVdp 7,0  	; 	
     250   02:803E                      
     251   02:803E  DB 99               1:  in  a,(0x99)	; 	wait raster line
     252   02:8040  E6 5F               	and %01011111
     253   02:8042  FE 44               	cp  %01000100	; 	plane 4 =0x44
     254   02:8044  C2 3E 80            	jp  nz,1b
     255   02:8047                      
     256   02:8047                      	_setVdp 0,0x02  ;	screen 2
     256   02:8047  3E 02             >     ld  a,value
     256   02:8049  D3 99             >     out (0x99),a
     256   02:804B  3E 80             >     ld  a,register + 0x80
     256   02:804D  D3 99             >     out (0x99),a
     257   02:804F                      
     258   02:804F  3A 09 E0            	ld  a,(vpage)	
     259   02:8052  A7                  	and a
     260   02:8053  CA 69 80            	jp  z,page0
     261   02:8056                      page1:				; 	page 1 active
     262   02:8056                      	_setVdp 3,0x9F	; 	colours at 0x2000	(hybrid)
     262   02:8056  3E 9F             >     ld  a,value
     262   02:8058  D3 99             >     out (0x99),a
     262   02:805A  3E 83             >     ld  a,register + 0x80
     262   02:805C  D3 99             >     out (0x99),a
     263   02:805E                      	_setVdp 4,0x03	;	patterns at 0x0000	(regular: used 0x0800 0x1000)
     263   02:805E  3E 03             >     ld  a,value
     263   02:8060  D3 99             >     out (0x99),a
     263   02:8062  3E 84             >     ld  a,register + 0x80
     263   02:8064  D3 99             >     out (0x99),a
     264   02:8066  C3 79 80            	jp  1f
     265   02:8069                      page0:				; 	page 0 active
     266   02:8069                      	_setVdp 3,0x1F	; 	colours at 0x0000	(hybrid)
     266   02:8069  3E 1F             >     ld  a,value
     266   02:806B  D3 99             >     out (0x99),a
     266   02:806D  3E 83             >     ld  a,register + 0x80
     266   02:806F  D3 99             >     out (0x99),a
     267   02:8071                      	_setVdp 4,0x07	;	patterns at 0x2000	(regular: used 0x2800 0x3000)
     267   02:8071  3E 07             >     ld  a,value
     267   02:8073  D3 99             >     out (0x99),a
     267   02:8075  3E 84             >     ld  a,register + 0x80
     267   02:8077  D3 99             >     out (0x99),a
     268   02:8079                      1:
     269   02:8079                      	_setVdp 5,0x36  ;   SAT at 0x1b00
     269   02:8079  3E 36             >     ld  a,value
     269   02:807B  D3 99             >     out (0x99),a
     269   02:807D  3E 85             >     ld  a,register + 0x80
     269   02:807F  D3 99             >     out (0x99),a
     270   02:8081                      	_setVdp 6,0x07  ;   SPT at 0x3800   (64 sprites 16x16)
     270   02:8081  3E 07             >     ld  a,value
     270   02:8083  D3 99             >     out (0x99),a
     270   02:8085  3E 86             >     ld  a,register + 0x80
     270   02:8087  D3 99             >     out (0x99),a
     271   02:8089                      
     272   02:8089  DD E1               	pop    ix
     273   02:808B  FD E1               	pop    iy
     274   02:808D  F1                  	pop    af
     275   02:808E  C1                  	pop    bc
     276   02:808F  D1                  	pop    de
     277   02:8090  E1                  	pop    hl
     278   02:8091  08                  	ex     af,af'
     279   02:8092  D9                  	exx
     280   02:8093  F1                  	pop    af
     281   02:8094  C1                  	pop    bc
     282   02:8095  D1                  	pop    de
     283   02:8096  E1                  	pop    hl
     284   02:8097  FB                  	ei
     285   02:8098  C9                  	ret
     286   02:8099                      
     287   02:8099                      
     288   02:8099                      ; ------------
     289   02:8099                      ; megarom header
     290   02:8099                      
     291   02:8099  (00)                	page 0
     292   00:4000                      	code page 0
     293   00:4000                      
     294   00:4000                      	org	04000h
     295   00:4000  41 42               	db	041h,042h
     296   00:4002  06 44               	dw	initmain
     297   00:4004                      	dz 	'TRI004'
     297   00:4004  54 52 49 30 30 34 00 
     298   00:400B  00 (5)              	ds	5
     299   00:4010                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     300   00:4010                      ;
     301   00:4010                      ; checkkbd: ckeck keyboard line
     302   00:4010                      ; in:  E = row
     303   00:4010                      ; out: L = bit pattern (1 = not pressed)
     304   00:4010                      ;
     305   00:4010                      ; row/bit|    7     6     5     4     3     2     1     0
     306   00:4010                      ; -------+--------------------------------------------------
     307   00:4010                      ;    0   |    7     6     5     4     3     2     1     0
     308   00:4010                      ;    1   |    ;     ]     [     \     =     -     9     8
     309   00:4010                      ;    2   |    B     A    ???    /     .     ,     '     `
     310   00:4010                      ;    3   |    J     I     H     G     F     E     D     C
     311   00:4010                      ;    4   |    R     Q     P     O     N     M     L     K
     312   00:4010                      ;    5   |    Z     Y     X     W     V     U     T     S
     313   00:4010                      ;    6   |   F3    F2    F1   CODE   CAP  GRAPH CTRL  SHIFT
     314   00:4010                      ;    7   |   RET   SEL   BS   STOP   TAB   ESC   F5    F4
     315   00:4010                      ;    8   |  RIGHT DOWN   UP   LEFT   DEL   INS  HOME  SPACE
     316   00:4010                      ;    9   |    4     3     2     1     0     /     +     *
     317   00:4010                      ;   10   |    .     ,     -     9     8     7     6     5
     318   00:4010                      ;   11   |                           NO          YES
     319   00:4010                      ;
     320   00:4010                      ;
     321   00:4010                      
     322   00:4010  (00:00A9)           i8255portb  equ 0a9h        ; keyboard column input
     323   00:4010  (00:00AA)           i8255portc  equ 0aah        ; leds, motor, cassette, kbd line
     324   00:4010                      
     325   00:4010                      checkkbd:
     326   00:4010  DB AA               	in  a,(i8255portc)
     327   00:4012  E6 F0               	and 011110000B          ; upper 4 bits contain info to preserve
     328   00:4014  B3                  	or  e
     329   00:4015  D3 AA               	out (i8255portc),a
     330   00:4017  DB A9               	in  a,(i8255portb)
     331   00:4019  6F                  	ld  l,a
     332   00:401A  C9                  	ret
     333   00:401B                      
     334   00:401B                      
     335   00:401B                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     336   00:401B                      ; vdp access
     337   00:401B                      
     338   00:401B  (00:F3DF)           _vdpReg equ 0xF3DF
     339   00:401B  (00:F3AE)           LINL40	equ 0xF3AE
     340   00:401B                      
     341   00:401B                      ; e = screen mode
     342   00:401B                      _scr2:
     343   00:401B  3A E0 F3            	ld	a,(_vdpReg+1)
     344   00:401E  F6 02               	or 2
     345   00:4020  32 E0 F3            	ld	(_vdpReg+1),a
     346   00:4023                      
     347   00:4023  3E 02               	ld	a,2
     348   00:4025  CD 5F 00            	call 0x005f
     349   00:4028                      
     350   00:4028  C9                  	ret
     351   00:4029                      
     352   00:4029                      ; set sprites
     353   00:4029                      
     354   00:4029                      set_sprites:
     355   00:4029                      	setvdpwvram 0x3800
     355   00:4029  F3                >     di
     355   00:402A                    >     _setvdpwvram value
     355   00:402A                    >     if (value & 0xFF)
     355   00:402A                    ~         ld  a,value & 0xFF
     355   00:402A                    ~     else
     355   00:402A  AF                >         xor a
     355   00:402B                    >     endif
     355   00:402B  D3 99             >     out (0x99),a
     355   00:402D  3E 78             >     ld  a,0x40 + (value/256)
     355   00:402F  D3 99             >     out (0x99),a
     355   00:4031  FB                >     ei
     356   00:4032  21 00 A0            	ld	hl,test_spt
     357   00:4035  3E 05               	ld	a,:test_spt
     358   00:4037  CD 52 40            	call	write_256
     359   00:403A  76                  	halt
     360   00:403B                      	setvdpwvram 0x1B00
     360   00:403B  F3                >     di
     360   00:403C                    >     _setvdpwvram value
     360   00:403C                    >     if (value & 0xFF)
     360   00:403C                    ~         ld  a,value & 0xFF
     360   00:403C                    ~     else
     360   00:403C  AF                >         xor a
     360   00:403D                    >     endif
     360   00:403D  D3 99             >     out (0x99),a
     360   00:403F  3E 5B             >     ld  a,0x40 + (value/256)
     360   00:4041  D3 99             >     out (0x99),a
     360   00:4043  FB                >     ei
     361   00:4044  21 50 AF            	ld	hl,test_sat
     362   00:4047  3E 05               	ld	a,:test_sat
     363   00:4049  32 00 B0            	ld	(_bank4),a
     364   00:404C  01 98 80            	ld	bc,0x8098
     365   00:404F  ED B3               	otir
     366   00:4051  C9                  	ret
     367   00:4052                      
     368   00:4052                      write_256:
     369   00:4052  32 00 B0            	ld	(_bank4),a
     370   00:4055  01 98 00            	ld	bc,0x0098
     371   00:4058  3E 08               	ld	a,8
     372   00:405A  ED A3               1:	outi
     373   00:405C  C2 5A 40            	jp nz,1b
     374   00:405F  3D                  	dec	a
     375   00:4060  C2 5A 40            	jp nz,1b
     376   00:4063  C9                  	ret
     377   00:4064                      
     378   00:4064                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     379   00:4064                      ;	Initialise the tiles common to all banks
     380   00:4064                      ;	Common tiles are stored only once in a separate bank
     381   00:4064                      ;
     382   00:4064                      initcommontiles:
     383   00:4064  3E 04               	ld	a,:common_pattern
     384   00:4066  32 00 B0            	ld (_bank4),a
     385   00:4069  21 00 A0            	ld	hl,common_pattern
     386   00:406C  3E CA               	ld	a,CommonTiles
     387   00:406E  11 00 48            	ld	de,0x0800 + 4000h
     388   00:4071  CD 77 41            	call write_2k
     389   00:4074                      
     390   00:4074  21 00 A0            	ld	hl,common_pattern
     391   00:4077  3E CA               	ld	a,CommonTiles
     392   00:4079  11 00 50            	ld	de,0x1000 + 4000h
     393   00:407C  CD 77 41            	call write_2k
     394   00:407F                      
     395   00:407F  21 00 A0            	ld	hl,common_pattern
     396   00:4082  3E CA               	ld	a,CommonTiles
     397   00:4084  11 00 68            	ld	de,0x2800 + 4000h
     398   00:4087  CD 77 41            	call write_2k
     399   00:408A                      
     400   00:408A  21 00 A0            	ld	hl,common_pattern
     401   00:408D  3E CA               	ld	a,CommonTiles
     402   00:408F  11 00 70            	ld	de,0x3000 + 4000h
     403   00:4092  CD 77 41            	call write_2k
     404   00:4095                      
     405   00:4095  3E 04               	ld	a,:common_color
     406   00:4097  32 00 B0            	ld (_bank4),a
     407   00:409A  21 50 A6            	ld	hl,common_color
     408   00:409D  3E CA               	ld	a,CommonTiles
     409   00:409F  11 00 60            	ld	de,0x2000 + 4000h
     410   00:40A2  CD 77 41            	call write_2k
     411   00:40A5  21 50 A6            	ld	hl,common_color
     412   00:40A8  3E CA               	ld	a,CommonTiles
     413   00:40AA  11 00 40            	ld	de,0x0000 + 4000h
     414   00:40AD  CD 77 41            	call write_2k
     415   00:40B0  C9                  	ret
     416   00:40B1                      
     417   00:40B1                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     418   00:40B1                      ;	load tile sets: only differences are loaded
     419   00:40B1                      
     420   00:40B1                      setvramp:
     421   00:40B1  3A 09 E0            	ld	a,(vpage)
     422   00:40B4  A7                  	and	a
     423   00:40B5  CA BB 40            	jp	z,setvramp1	;	PGT at	0x0800/0x1000,	PCT at 0x0800
     424   00:40B8  C3 EE 40            	jp	setvramp0	;	PGT at	0x2800/0x3000,	PCT at 0x0000
     425   00:40BB                      
     426   00:40BB                      setvramp1:			;	PGT at	0x0800/0x1000,	PGT at 0x2000
     427   00:40BB  CD 21 41            	call getbank	;->a
     428   00:40BE  32 00 B0            	ld (_bank4),a
     429   00:40C1  CD 3B 41            	call getsize	;->a
     430   00:40C4  CD 2D 41            	call getaddr	;->hl
     431   00:40C7  11 50 4E            	ld	de,0x0800 + 8*CommonTiles + 4000h
     432   00:40CA  CD 77 41            	call write_2k
     433   00:40CD                      
     434   00:40CD  CD 3B 41            	call getsize	;->a
     435   00:40D0  CD 2D 41            	call getaddr	;->hl
     436   00:40D3  11 50 56            	ld	de,0x1000 + 8*CommonTiles + 4000h
     437   00:40D6  CD 77 41            	call write_2k
     438   00:40D9                      
     439   00:40D9  CD 21 41            	call getbank	;->a
     440   00:40DC  C6 04               	add	a,4			; colorbank = tilebank+4
     441   00:40DE  32 00 B0            	ld (_bank4),a
     442   00:40E1  CD 3B 41            	call getsize	;->a
     443   00:40E4  CD 2D 41            	call getaddr	;->hl
     444   00:40E7  11 50 66            	ld	de,0x2000 + 8*CommonTiles + 4000h
     445   00:40EA  CD 77 41            	call write_2k
     446   00:40ED  C9                  	ret
     447   00:40EE                      
     448   00:40EE                      setvramp0:			;	PGT at	0x2800/0x3000,	PGT at 0x0000
     449   00:40EE  CD 21 41            	call getbank	;->a
     450   00:40F1  32 00 B0            	ld (_bank4),a
     451   00:40F4  CD 3B 41            	call getsize	;->a
     452   00:40F7  CD 2D 41            	call getaddr	;->hl
     453   00:40FA  11 50 6E            	ld	de,0x2800 + 8*CommonTiles + 4000h
     454   00:40FD  CD 77 41            	call write_2k
     455   00:4100                      
     456   00:4100  CD 3B 41            	call getsize	;->a
     457   00:4103  CD 2D 41            	call getaddr	;->hl
     458   00:4106  11 50 76            	ld	de,0x3000 + 8*CommonTiles + 4000h
     459   00:4109  CD 77 41            	call write_2k
     460   00:410C                      
     461   00:410C  CD 21 41            	call getbank	;->a
     462   00:410F  C6 04               	add	a,4			; colorbank = tilebank+4
     463   00:4111  32 00 B0            	ld (_bank4),a
     464   00:4114  CD 3B 41            	call getsize	;->a
     465   00:4117  CD 2D 41            	call getaddr	;->hl
     466   00:411A  11 50 46            	ld	de,0x0000 + 8*CommonTiles + 4000h
     467   00:411D  CD 77 41            	call write_2k
     468   00:4120  C9                  	ret
     469   00:4121                      
     470   00:4121                      getbank:
     471   00:4121  ED 5B 08 E0         	ld	de,(phase)
     472   00:4125  21 47 41            	ld	hl,tilebank
     473   00:4128  16 00               	ld	d,0
     474   00:412A  19                  	add	hl,de
     475   00:412B  7E                  	ld	a,(hl)
     476   00:412C  C9                  	ret
     477   00:412D                      getaddr:
     478   00:412D  ED 5B 08 E0         	ld	de,(phase)
     479   00:4131  21 67 41            	ld	hl,tileaddress
     480   00:4134  16 00               	ld	d,0
     481   00:4136  19                  	add	hl,de
     482   00:4137  66                  	ld	h,(hl)
     483   00:4138  2E 00               	ld	l,0
     484   00:413A  C9                  	ret
     485   00:413B                      getsize:
     486   00:413B  ED 5B 08 E0         	ld	de,(phase)
     487   00:413F  21 57 41            	ld	hl,tilesize
     488   00:4142  16 00               	ld	d,0
     489   00:4144  19                  	add	hl,de
     490   00:4145  7E                  	ld	a,(hl)
     491   00:4146  C9                  	ret
     492   00:4147                      
     493   00:4147                      
     494   00:4147                      	;	patternsxy
     495   00:4147                      tilebank:
     496   00:4147  08 08 08 08         	db	:patterns11_13_15_17,:patterns11_13_15_17,:patterns11_13_15_17,:patterns11_13_15_17
     497   00:414B  09 09 09 09         	db	:patterns31_33_35_37,:patterns31_33_35_37,:patterns31_33_35_37,:patterns31_33_35_37
     498   00:414F  0A 0A 0A 0A         	db	:patterns51_53_55_57,:patterns51_53_55_57,:patterns51_53_55_57,:patterns51_53_55_57
     499   00:4153  0B 0B 0B 0B         	db	:patterns71_73_75_77,:patterns71_73_75_77,:patterns71_73_75_77,:patterns71_73_75_77
     500   00:4157                      tilesize:
     501   00:4157  1E 2F 2E 2C         	db	TileSize11-CommonTiles,TileSize13-CommonTiles,TileSize15-CommonTiles,TileSize17-CommonTiles
     502   00:415B  30 35 35 35         	db	TileSize31-CommonTiles,TileSize33-CommonTiles,TileSize35-CommonTiles,TileSize37-CommonTiles
     503   00:415F  35 35 35 35         	db	TileSize51-CommonTiles,TileSize53-CommonTiles,TileSize55-CommonTiles,TileSize57-CommonTiles
     504   00:4163  2B 35 36 36         	db	TileSize71-CommonTiles,TileSize73-CommonTiles,TileSize75-CommonTiles,TileSize77-CommonTiles
     505   00:4167                      tileaddress:
     506   00:4167  A0 A8 B0 B8         	db	(patterns_base+0*2*1024)/256,(patterns_base+1*2*1024)/256,(patterns_base+2*2*1024)/256,(patterns_base+3*2*1024)/256
     507   00:416B  A0 A8 B0 B8         	db	(patterns_base+0*2*1024)/256,(patterns_base+1*2*1024)/256,(patterns_base+2*2*1024)/256,(patterns_base+3*2*1024)/256
     508   00:416F  A0 A8 B0 B8         	db	(patterns_base+0*2*1024)/256,(patterns_base+1*2*1024)/256,(patterns_base+2*2*1024)/256,(patterns_base+3*2*1024)/256
     509   00:4173  A0 A8 B0 B8         	db	(patterns_base+0*2*1024)/256,(patterns_base+1*2*1024)/256,(patterns_base+2*2*1024)/256,(patterns_base+3*2*1024)/256
     510   00:4177                      
     511   00:4177                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     512   00:4177                      ; write 2K while ints are active from hl to de
     513   00:4177                      ; in: de vram address
     514   00:4177                      ;     hl ram address
     515   00:4177                      ;	   a counter of 8 bytes chunks
     516   00:4177                      write_2k:
     517   00:4177  F3                  	di
     518   00:4178  0E 99               	ld	c,0x99
     519   00:417A  ED 59               	out (c),e
     520   00:417C  ED 51               	out (c),d	;c = 0x99, HL with write setup bit set
     521   00:417E                      
     522   00:417E  5F                  	ld	e,a
     523   00:417F  16 00               	ld	d,0
     524   00:4181  EB                  	ex	de,hl
     525   00:4182  29 29 29            [3]	add hl,hl
     526   00:4185  EB                  	ex	de,hl
     527   00:4186                      	
     528   00:4186  0D                  	dec	c
     529   00:4187  14                  	inc	d
     530   00:4188  43                  	ld	b,e
     531   00:4189  ED A3               2:	outi
     532   00:418B  C2 89 41            	jp nz,2b
     533   00:418E  15                  	dec	d
     534   00:418F  C2 89 41            	jp nz,2b	
     535   00:4192  FB                  	ei
     536   00:4193  C9                  	ret
     537   00:4194                      	
     538   00:4194                      ; write_2k:
     539   00:4194                      	; push hl
     540   00:4194                      	; ex	de,hl
     541   00:4194                      	; set	6,h
     542   00:4194                      	; ld	c,0x99
     543   00:4194                      	; ld	de,8
     544   00:4194                      	; exx
     545   00:4194                      	; pop	hl		; ram source in HL'
     546   00:4194                      	; ld	c,0x98	; data port in c'
     547   00:4194                      ; 2:	di
     548   00:4194                      	; exx
     549   00:4194                      	; out (c),l
     550   00:4194                      	; out (c),h	;c = 0x99, HL with write setup bit set
     551   00:4194                      	; add hl,de	;de = 8
     552   00:4194                      	; exx
     553   00:4194                      	; ld b,8
     554   00:4194                      ; 1:	outi		;c' = 0x98
     555   00:4194                      	; jp nz,1b
     556   00:4194                      	; ei
     557   00:4194                      	; dec a
     558   00:4194                      	; jp nz,2b
     559   00:4194                      	; ret
     560   00:4194                      
     561   00:4194                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     562   00:4194                      ;	in xmap,ymap
     563   00:4194                      ;
     564   00:4194                      plot_pnt:
     565   00:4194  3E 07               	ld	a,:metavec
     566   00:4196  32 00 B0            	ld	(_bank4),a
     567   00:4199                      
     568   00:4199  21 00 C0            	ld	hl,buffer	; meta map in ram
     569   00:419C                      
     570   00:419C  3A 05 E0            	ld	a,(ymap+1)	; ymap 8.8
     571   00:419F  A7                  	and	a
     572   00:41A0  28 07               	jr	z,1f
     573   00:41A2  01 60 00            	ld	bc,LvlWidth
     574   00:41A5  09                  2:	add	hl,bc
     575   00:41A6  3D                  	dec a
     576   00:41A7  20 FC               	jr	nz,2b
     577   00:41A9                      1:
     578   00:41A9  3A 03 E0            	ld	a,(xmap+1)	; xmap 8.8
     579   00:41AC  5F                  	ld	e,a
     580   00:41AD  16 00               	ld	d,0
     581   00:41AF  19                  	add	hl,de
     582   00:41B0  EB                  	ex	de,hl		; DE = buffer + round(ymap)*LvlWidth+round(xmap)
     583   00:41B1                      
     584   00:41B1                      	setvdpwvram 0x1900
     584   00:41B1  F3                >     di
     584   00:41B2                    >     _setvdpwvram value
     584   00:41B2                    >     if (value & 0xFF)
     584   00:41B2                    ~         ld  a,value & 0xFF
     584   00:41B2                    ~     else
     584   00:41B2  AF                >         xor a
     584   00:41B3                    >     endif
     584   00:41B3  D3 99             >     out (0x99),a
     584   00:41B5  3E 59             >     ld  a,0x40 + (value/256)
     584   00:41B7  D3 99             >     out (0x99),a
     584   00:41B9  FB                >     ei
     585   00:41BA                      	
     586   00:41BA  0E 98               	ld  c,0x98
     587   00:41BC  DD 26 10            	ld  ixh,16
     588   00:41BF                      
     589   00:41BF  3A 08 E0            	ld	a,(phase)
     590   00:41C2  C6 A0               	add	a,metavec/256
     591   00:41C4                      	
     592   00:41C4                      1:	
     593   00:41C4  67                  	ld	h,a
     594   00:41C5  08                  	ex	af',af
     595   00:41C6                      	
     596   00:41C6  7B                  	ld  a,e
     597   00:41C7  C6 20               	add a,32
     598   00:41C9  D2 78 42            	jp  nc,.fast_loop
     599   00:41CC                      
     600   00:41CC                      	
     601   00:41CC                      	repeat 32
     602   00:41CC                    < 	ld	a,(de)
     603   00:41CC                    < 	ld	l,a
     604   00:41CC                    < 	outi         	; Send data pointed by HL to VDP port (reg.C preloaded)
     605   00:41CC                    < 	inc	de
     606   00:41CC                    < 	endrepeat
     606   00:41CC  1A 6F ED A3 13 1A 6F ED A3 13 1A 6F ED A3 13 1A 
     606   00:41DC  6F ED A3 13 1A 6F ED A3 13 1A 6F ED A3 13 1A 6F 
     606   00:41EC  ED A3 13 1A 6F ED A3 13 1A 6F ED A3 13 1A 6F ED 
     606   00:41FC  A3 13 1A 6F ED A3 13 1A 6F ED A3 13 1A 6F ED A3 
     606   00:420C  13 1A 6F ED A3 13 1A 6F ED A3 13 1A 6F ED A3 13 
     606   00:421C  1A 6F ED A3 13 1A 6F ED A3 13 1A 6F ED A3 13 1A 
     606   00:422C  6F ED A3 13 1A 6F ED A3 13 1A 6F ED A3 13 1A 6F 
     606   00:423C  ED A3 13 1A 6F ED A3 13 1A 6F ED A3 13 1A 6F ED 
     606   00:424C  A3 13 1A 6F ED A3 13 1A 6F ED A3 13 1A 6F ED A3 
     606   00:425C  13 1A 6F ED A3 13 1A 6F ED A3 13 1A 6F ED A3 13 
     607   00:426C                      	
     608   00:426C  08                  	ex	af',af
     609   00:426D                      	
     610   00:426D  21 40 00            	ld	hl,LvlWidth-32
     611   00:4270  19                  	add	hl,de
     612   00:4271  EB                  	ex	de,hl
     613   00:4272                      
     614   00:4272  DD 25               	dec ixh
     615   00:4274  C2 C4 41            	jp nz,1b
     616   00:4277                      
     617   00:4277  C9                  	ret
     618   00:4278                      
     619   00:4278                      .fast_loop
     620   00:4278                      
     621   00:4278                      	repeat 32
     622   00:4278                    < 	ld	a,(de)
     623   00:4278                    < 	ld	l,a
     624   00:4278                    < 	outi         	; Send data pointed by HL to VDP port (reg.C preloaded)
     625   00:4278                    < 	inc	e			; save 32 INC DE 
     626   00:4278                    < 	endrepeat
     626   00:4278  1A 6F ED A3 1C 1A 6F ED A3 1C 1A 6F ED A3 1C 1A 
     626   00:4288  6F ED A3 1C 1A 6F ED A3 1C 1A 6F ED A3 1C 1A 6F 
     626   00:4298  ED A3 1C 1A 6F ED A3 1C 1A 6F ED A3 1C 1A 6F ED 
     626   00:42A8  A3 1C 1A 6F ED A3 1C 1A 6F ED A3 1C 1A 6F ED A3 
     626   00:42B8  1C 1A 6F ED A3 1C 1A 6F ED A3 1C 1A 6F ED A3 1C 
     626   00:42C8  1A 6F ED A3 1C 1A 6F ED A3 1C 1A 6F ED A3 1C 1A 
     626   00:42D8  6F ED A3 1C 1A 6F ED A3 1C 1A 6F ED A3 1C 1A 6F 
     626   00:42E8  ED A3 1C 1A 6F ED A3 1C 1A 6F ED A3 1C 1A 6F ED 
     626   00:42F8  A3 1C 1A 6F ED A3 1C 1A 6F ED A3 1C 1A 6F ED A3 
     626   00:4308  1C 1A 6F ED A3 1C 1A 6F ED A3 1C 1A 6F ED A3 1C 
     627   00:4318                      	
     628   00:4318  08                  	ex	af',af
     629   00:4319                      	
     630   00:4319  21 40 00            	ld	hl,LvlWidth-32
     631   00:431C  19                  	add	hl,de
     632   00:431D  EB                  	ex	de,hl
     633   00:431E                      
     634   00:431E  DD 25               	dec ixh
     635   00:4320  C2 C4 41            	jp nz,1b
     636   00:4323                      
     637   00:4323  C9                  	ret
     638   00:4324                      	
     639   00:4324                      	
     640   00:4324                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     641   00:4324                      
     642   00:4324                      ;          defb 0x02 ; Reg# 0 000000[M3][EV]
     643   00:4324                      ;          defb 0x62 ; Reg# 1 [4/16k][BLANK][IE][M1][M2]0[SIZE][MAG]
     644   00:4324                      ;          defb 0x06 ; Reg# 2 0000[NAME TABLE BASE ADDRESS]          = 1800h
     645   00:4324                      
     646   00:4324                      ;          defb 0x9F ; Reg# 3 [COLOR BASE ADDRESS]                   = 2000h ; hybrid mode for colors
     647   00:4324                      ;          defb 0xFF ; Reg# 3 [COLOR BASE ADDRESS]                   = 2000h ; regular mode for colors
     648   00:4324                      
     649   00:4324                      ;          defb 0x1F ; Reg# 3 [COLOR BASE ADDRESS]                   = 0000h ; hybrid mode for colors
     650   00:4324                      ;          defb 0x7F ; Reg# 3 [COLOR BASE ADDRESS]                   = 0000h ; regular mode for colors
     651   00:4324                      
     652   00:4324                      ;          defb 0x00 ; Reg# 4 00000[PATTERN GENERATOR BASE ADDRESS]  = 0000h ; hybrid mode for patterns
     653   00:4324                      ;          defb 0x03 ; Reg# 4 00000[PATTERN GENERATOR BASE ADDRESS]  = 0000h ; regular mode for patterns
     654   00:4324                      
     655   00:4324                      ;          defb 0x04 ; Reg# 4 00000[PATTERN GENERATOR BASE ADDRESS]  = 2000h ; hybrid mode for patterns
     656   00:4324                      ;          defb 0x07 ; Reg# 4 00000[PATTERN GENERATOR BASE ADDRESS]  = 2000h ; regular mode for patterns
     657   00:4324                      
     658   00:4324                      ;          defb 0x36 ; Reg# 5 0[SPRITE ATTRIBUTE TABLE BASE ADDRESS] = 1b00h
     659   00:4324                      ;          defb 0x07 ; Reg# 6 00000[SPRITE PTRN GNRTR BASE ADDRESS]  = 3800h
     660   00:4324                      ;          defb 0x01 ; Reg# 7 [TEXT COLOR 4bts][BACKDROP COLOR 4bts]
     661   00:4324                      
     662   00:4324                      
     663   00:4324                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     664   00:4324                      disp_page1:			; page 1 active
     665   00:4324                      	_setVdp 3,0x9F	; 	colours at 0x2000	(hybrid)
     665   00:4324  3E 9F             >     ld  a,value
     665   00:4326  D3 99             >     out (0x99),a
     665   00:4328  3E 83             >     ld  a,register + 0x80
     665   00:432A  D3 99             >     out (0x99),a
     666   00:432C                      	_setVdp 4,0x03	;	patterns at 0x0000	(regular: used 0x0800 0x1000)
     666   00:432C  3E 03             >     ld  a,value
     666   00:432E  D3 99             >     out (0x99),a
     666   00:4330  3E 84             >     ld  a,register + 0x80
     666   00:4332  D3 99             >     out (0x99),a
     667   00:4334  C9                  	ret
     668   00:4335                      
     669   00:4335                      disp_page0:			; page 0 active
     670   00:4335                      	_setVdp 3,0x1F	; 	colours at 0x0000	(hybrid)
     670   00:4335  3E 1F             >     ld  a,value
     670   00:4337  D3 99             >     out (0x99),a
     670   00:4339  3E 83             >     ld  a,register + 0x80
     670   00:433B  D3 99             >     out (0x99),a
     671   00:433D                      	_setVdp 4,0x07	;	patterns at 0x2000	(regular: used 0x2800 0x3000)
     671   00:433D  3E 07             >     ld  a,value
     671   00:433F  D3 99             >     out (0x99),a
     671   00:4341  3E 84             >     ld  a,register + 0x80
     671   00:4343  D3 99             >     out (0x99),a
     672   00:4345  C9                  	ret
     673   00:4346                      
     674   00:4346                      
     675   00:4346                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     676   00:4346                      ; set pages and subslot
     677   00:4346                      ;
     678   00:4346                      
     679   00:4346                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     680   00:4346                      ; set pages and subslot
     681   00:4346                      ;
     682   00:4346                      
     683   00:4346                      
     684   00:4346  (00:0024)           ENASLT:         equ     024h
     685   00:4346  (00:0138)           RSLREG:         equ     0138h
     686   00:4346  (00:FCC1)           EXPTBL:         equ     0FCC1h  ; Bios Slot / Expansion Slot
     687   00:4346                      
     688   00:4346                      ; -----------------------
     689   00:4346                      ; SEARCH_SLOTSET
     690   00:4346                      ; Posiciona en pagina 2
     691   00:4346                      ; Nuestro ROM.
     692   00:4346                      ; -----------------------
     693   00:4346                      
     694   00:4346                      search_slotset:
     695   00:4346  F3                  	di
     696   00:4347  CD 5E 43            	call    search_slot
     697   00:434A  CD 24 00            	call	ENASLT
     698   00:434D                      	
     699   00:434D                      	; now we have:
     700   00:434D                      	; page 0 	- bios
     701   00:434D                      	; page 1,2	- megarom mapper
     702   00:434D                      	; page 3	- RAM
     703   00:434D                      
     704   00:434D                      	; init megarom mapper
     705   00:434D  AF                  	xor	a
     706   00:434E  32 00 50            	ld	(_bank1),a
     707   00:4351  3C                  	inc	a
     708   00:4352  32 00 70            	ld	(_bank2),a
     709   00:4355  3C                  	inc	a
     710   00:4356  32 00 90            	ld	(_bank3),a
     711   00:4359  3C                  	inc	a
     712   00:435A  32 00 B0            	ld	(_bank4),a
     713   00:435D                      
     714   00:435D  C9                  	ret
     715   00:435E                      
     716   00:435E                      
     717   00:435E                      ; -----------------------
     718   00:435E                      ; SEARCH_SLOT
     719   00:435E                      ; Busca slot de nuestro rom
     720   00:435E                      ; -----------------------
     721   00:435E                      
     722   00:435E                      search_slot:
     723   00:435E  CD 38 01            	call    RSLREG
     724   00:4361  0F                  	rrca
     725   00:4362  0F                  	rrca
     726   00:4363  E6 03               	and     3
     727   00:4365  4F                  	ld      c,a
     728   00:4366  06 00               	ld      b,0
     729   00:4368  21 C1 FC            	ld      hl,EXPTBL
     730   00:436B  09                  	add     hl,bc
     731   00:436C  7E                  	ld      a,(hl)
     732   00:436D  E6 80               	and     080h
     733   00:436F  B1                  	or      c
     734   00:4370  4F                  	ld      c,a
     735   00:4371  23                  	inc     hl
     736   00:4372  23                  	inc     hl
     737   00:4373  23                  	inc     hl
     738   00:4374  23                  	inc     hl
     739   00:4375  7E                  	ld      a,(hl)
     740   00:4376  E6 0C               	and     0Ch
     741   00:4378  B1                  	or      c;
     742   00:4379  26 80               	ld      h,080h
     743   00:437B  32 00 E0            	ld      (slotvar),a
     744   00:437E  C9                  	ret
     745   00:437F                      
     746   00:437F                      ; ------------------------------
     747   00:437F                      ; SETROMPAGE0
     748   00:437F                      ; Posiciona nuestro cartucho en
     749   00:437F                      ; Pagina 0
     750   00:437F                      ; -----------------------------
     751   00:437F                      
     752   00:437F                      setrompage0:
     753   00:437F  3A 00 E0            	ld      a,(slotvar)
     754   00:4382  18 03               	jr      setslotpage0
     755   00:4384                      
     756   00:4384                      ; ------------------------------
     757   00:4384                      ; RECBIOS
     758   00:4384                      ; Posiciona la bios ROM
     759   00:4384                      ; -------------------------------
     760   00:4384                      recbios:
     761   00:4384  3A C1 FC            	ld      a,(EXPTBL)
     762   00:4387                      
     763   00:4387                      ; ---------------------------
     764   00:4387                      ; SETSLOTPAGE0
     765   00:4387                      ; Posiciona el slot pasado
     766   00:4387                      ; en pagina 0 del Z80
     767   00:4387                      ; A: Formato FxxxSSPP
     768   00:4387                      ; ----------------------------
     769   00:4387                      
     770   00:4387                      setslotpage0:
     771   00:4387  F3                  	di
     772   00:4388  47                  	ld      b,a                 ; B = Slot param in FxxxSSPP format
     773   00:4389                      
     774   00:4389  DB A8               	in      a,(0A8h)
     775   00:438B  E6 FC               	and     0xFC
     776   00:438D  57                  	ld      d,a                 ; D = Primary slot value
     777   00:438E                      
     778   00:438E  78                  	ld      a,b
     779   00:438F                      
     780   00:438F  E6 03               	and     3
     781   00:4391  B2                  	or      d
     782   00:4392  57                  	ld      d,a                 ; D = Final Value for primary slot
     783   00:4393                      
     784   00:4393                      	; Check if expanded
     785   00:4393  78                  	ld      a,b
     786   00:4394  CB 7F               	bit     7,a
     787   00:4396  28 21               	jr      z,1f    ; Not Expanded
     788   00:4398                      
     789   00:4398  E6 03               	and     3
     790   00:439A  0F                  	rrca
     791   00:439B  0F                  	rrca
     792   00:439C  E6 C0               	and     0xC0
     793   00:439E  4F                  	ld      c,a
     794   00:439F  7A                  	ld      a,d
     795   00:43A0  E6 3F               	and     0x3F
     796   00:43A2  B1                  	or      c
     797   00:43A3  4F                  	ld      c,a                 ; Primary slot value with main slot in page 3
     798   00:43A4                      
     799   00:43A4  78                  	ld      a,b
     800   00:43A5  E6 0C               	and     0x0C
     801   00:43A7  0F                  	rrca
     802   00:43A8  0F                  	rrca
     803   00:43A9  E6 03               	and     3
     804   00:43AB  47                  	ld      b,a                 ; B = Expanded slot in page 3
     805   00:43AC  79                  	ld      a,c
     806   00:43AD  D3 A8               	out     (0A8h),a            ; Slot : Main Slot, xx, xx, Main slot
     807   00:43AF  3A FF FF            	ld      a,(0FFFFh)
     808   00:43B2  2F                  	cpl
     809   00:43B3  E6 FC               	and     0xFC
     810   00:43B5  B0                  	or      b
     811   00:43B6  32 FF FF            	ld      (0FFFFh),a          ; Expanded slot selected
     812   00:43B9                      
     813   00:43B9                      1:
     814   00:43B9  7A                  	ld      a,d             ; A = Final value
     815   00:43BA  D3 A8               	out     (0A8h),a		; Slot Final. Ram, rom c, rom c, Main
     816   00:43BC  C9                  	ret
     817   00:43BD                      	
     818   00:43BD                      
     819   00:43BD                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     820   00:43BD                      ;
     821   00:43BD                      ;   load tile sets and sprites
     822   00:43BD                      vram_init:
     823   00:43BD                      	setvdpwvram 0x1B80              ; sprites in the scorebar
     823   00:43BD  F3                >     di
     823   00:43BE                    >     _setvdpwvram value
     823   00:43BE                    >     if (value & 0xFF)
     823   00:43BE  3E 80             >         ld  a,value & 0xFF
     823   00:43C0                    >     else
     823   00:43C0                    ~         xor a
     823   00:43C0                    ~     endif
     823   00:43C0  D3 99             >     out (0x99),a
     823   00:43C2  3E 5B             >     ld  a,0x40 + (value/256)
     823   00:43C4  D3 99             >     out (0x99),a
     823   00:43C6  FB                >     ei
     824   00:43C7  21 00 A4            	ld  hl,scorebar_sat
     825   00:43CA  3E 03               	ld	a,:scorebar_sat
     826   00:43CC  CD 52 40            	call    write_256
     827   00:43CF                      
     828   00:43CF                      	setvdpwvram 0x1C00
     828   00:43CF  F3                >     di
     828   00:43D0                    >     _setvdpwvram value
     828   00:43D0                    >     if (value & 0xFF)
     828   00:43D0                    ~         ld  a,value & 0xFF
     828   00:43D0                    ~     else
     828   00:43D0  AF                >         xor a
     828   00:43D1                    >     endif
     828   00:43D1  D3 99             >     out (0x99),a
     828   00:43D3  3E 5C             >     ld  a,0x40 + (value/256)
     828   00:43D5  D3 99             >     out (0x99),a
     828   00:43D7  FB                >     ei
     829   00:43D8  21 00 A0            	ld  hl,tileset					; dummy tile set from basic rom
     830   00:43DB  3E 03               	ld	a,:tileset
     831   00:43DD  CD 52 40            	call    write_256
     832   00:43E0                      
     833   00:43E0                      	setvdpwvram 0x1800				;   dummy PNT
     833   00:43E0  F3                >     di
     833   00:43E1                    >     _setvdpwvram value
     833   00:43E1                    >     if (value & 0xFF)
     833   00:43E1                    ~         ld  a,value & 0xFF
     833   00:43E1                    ~     else
     833   00:43E1  AF                >         xor a
     833   00:43E2                    >     endif
     833   00:43E2  D3 99             >     out (0x99),a
     833   00:43E4  3E 58             >     ld  a,0x40 + (value/256)
     833   00:43E6  D3 99             >     out (0x99),a
     833   00:43E8  FB                >     ei
     834   00:43E9  06 00               	ld	b,0
     835   00:43EB  3E 04               	ld	a,4
     836   00:43ED  D3 98               1:	out (0x98),a
     837   00:43EF  04                  	inc	b
     838   00:43F0  20 FB               	jr	nz,1b
     839   00:43F2                      
     840   00:43F2                      	setvdpwvram 0x1BD0
     840   00:43F2  F3                >     di
     840   00:43F3                    >     _setvdpwvram value
     840   00:43F3                    >     if (value & 0xFF)
     840   00:43F3  3E D0             >         ld  a,value & 0xFF
     840   00:43F5                    >     else
     840   00:43F5                    ~         xor a
     840   00:43F5                    ~     endif
     840   00:43F5  D3 99             >     out (0x99),a
     840   00:43F7  3E 5B             >     ld  a,0x40 + (value/256)
     840   00:43F9  D3 99             >     out (0x99),a
     840   00:43FB  FB                >     ei
     841   00:43FC  06 10               	ld	b,16				; 	dummy colors
     842   00:43FE  3E 11               	ld	a,11h
     843   00:4400  D3 98               1:	out (0x98),a
     844   00:4402  05                  	dec	b
     845   00:4403  20 FB               	jr	nz,1b
     846   00:4405  C9                  	ret
     847   00:4406                      
     848   00:4406                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     849   00:4406                      ; ROM initialisation
     850   00:4406                      
     851   00:4406                      initmain:
     852   00:4406                      	
     853   00:4406  CD 1B 40            	call _scr2				; screen 2
     854   00:4409                      	
     855   00:4409  CD 46 43            	call 	search_slotset	; now the first 32KB of the megarom are active
     856   00:440C                      			
     857   00:440C                      	;call	setrompage0		; 48K of rom are active - bios is excluded
     858   00:440C                      	
     859   00:440C                      	_setVdp 7,0
     859   00:440C  3E 00             >     ld  a,value
     859   00:440E  D3 99             >     out (0x99),a
     859   00:4410  3E 87             >     ld  a,register + 0x80
     859   00:4412  D3 99             >     out (0x99),a
     860   00:4414  FB                  	ei
     861   00:4415  CD 29 40            	call	set_sprites
     862   00:4418  CD BD 43            	call 	vram_init		; set data in the top 3d of the screen
     863   00:441B                      	
     864   00:441B  CD 64 40            	call	initcommontiles		;	load common tiles
     865   00:441E                      	
     866   00:441E                      	; move meta map in ram
     867   00:441E  3E 06               	ld	a,:metamap
     868   00:4420  32 00 B0            	ld	(_bank4),a
     869   00:4423  01 00 12            	ld	bc,LvlWidth*LvlHeigh
     870   00:4426  21 00 A0            	ld	hl,metamap
     871   00:4429  11 00 C0            	ld	de,buffer
     872   00:442C  ED B0               	ldir
     873   00:442E                      
     874   00:442E  21 00 80            	ld	hl,myisr
     875   00:4431  22 9B FD            	ld	(0xFD9A+1),hl
     876   00:4434  3E C3               	ld	a,0xC3
     877   00:4436  32 9A FD            	ld	(0xFD9A),a
     878   00:4439                      
     879   00:4439  21 00 00            	ld	hl,0
     880   00:443C  22 02 E0            	ld	(xmap),hl
     881   00:443F  22 04 E0            	ld	(ymap),hl
     882   00:4442  AF                  	xor a
     883   00:4443  32 06 E0            	ld	(dxmap),a
     884   00:4446  32 07 E0            	ld	(dymap),a
     885   00:4449  32 08 E0            	ld	(phase),a
     886   00:444C  3C                  	inc	a
     887   00:444D  32 09 E0            	ld	(vpage),a
     888   00:4450                      	
     889   00:4450                      
     890   00:4450                      mainloop:
     891   00:4450                      	
     892   00:4450  76                  	halt
     893   00:4451                      	; setVdp 7,8
     894   00:4451  CD 68 44            	call	show_activepage
     895   00:4454  CD 94 41            	call    plot_pnt		;	use phase to plot the correct PNT
     896   00:4457                      	; setVdp 7,0
     897   00:4457                      	
     898   00:4457  CD EA 44            	call	sub_main		; 	compute new "phase"
     899   00:445A                      
     900   00:445A                      	; setVdp 7,10
     901   00:445A  CD B1 40            	call	setvramp		;	use phase to select the tileset loaded to page 1/0
     902   00:445D                      	; setVdp 7,0
     903   00:445D                      		
     904   00:445D  3A 09 E0            	ld	a,(vpage)
     905   00:4460  EE 01               	xor 1					; 	swap page
     906   00:4462  32 09 E0            	ld	(vpage),a			
     907   00:4465                      		
     908   00:4465  C3 50 44            	jp 	mainloop
     909   00:4468                      	
     910   00:4468                      	
     911   00:4468                      show_activepage:	
     912   00:4468  3A 09 E0            	ld  a,(vpage)	
     913   00:446B  A7                  	and a
     914   00:446C  CA 82 44            	jp  z,.page0
     915   00:446F                      .page1:				; 	page 1 active
     916   00:446F  F3                  	di
     917   00:4470                      	_setVdp 3,0x9F	; 	PCT at 0x2000	(hybrid)
     917   00:4470  3E 9F             >     ld  a,value
     917   00:4472  D3 99             >     out (0x99),a
     917   00:4474  3E 83             >     ld  a,register + 0x80
     917   00:4476  D3 99             >     out (0x99),a
     918   00:4478                      	_setVdp 4,0x03	;	PGT at 0x0000	(regular: used 0x0800 0x1000)
     918   00:4478  3E 03             >     ld  a,value
     918   00:447A  D3 99             >     out (0x99),a
     918   00:447C  3E 84             >     ld  a,register + 0x80
     918   00:447E  D3 99             >     out (0x99),a
     919   00:4480  FB                  	ei
     920   00:4481  C9                  	ret
     921   00:4482                      .page0:				; 	page 0 active
     922   00:4482  F3                  	di
     923   00:4483                      	_setVdp 3,0x1F	; 	PCT at 0x0000	(hybrid)
     923   00:4483  3E 1F             >     ld  a,value
     923   00:4485  D3 99             >     out (0x99),a
     923   00:4487  3E 83             >     ld  a,register + 0x80
     923   00:4489  D3 99             >     out (0x99),a
     924   00:448B                      	_setVdp 4,0x07	;	PGT at 0x2000	(regular: used 0x2800 0x3000)
     924   00:448B  3E 07             >     ld  a,value
     924   00:448D  D3 99             >     out (0x99),a
     924   00:448F  3E 84             >     ld  a,register + 0x80
     924   00:4491  D3 99             >     out (0x99),a
     925   00:4493  FB                  	ei
     926   00:4494  C9                  	ret
     927   00:4495                      	
     928   00:4495                      dxdycontrol:
     929   00:4495  7D                  	ld  a,l
     930   00:4496  E6 80               	and 0x80    ; right
     931   00:4498  20 0C               	jr  nz,1f
     932   00:449A  3A 06 E0            	ld  a,(dxmap)
     933   00:449D  FE 80               	cp  maxspeed        ; MAX SPEED
     934   00:449F  28 05               	jr  z,1f
     935   00:44A1  C6 01               	add a,maxspeedstep
     936   00:44A3  32 06 E0            	ld  (dxmap),a
     937   00:44A6                      1:
     938   00:44A6  7D                  	ld  a,l
     939   00:44A7  E6 10               	and 0x10    ; left
     940   00:44A9  20 0C               	jr  nz,1f
     941   00:44AB  3A 06 E0            	ld  a,(dxmap)
     942   00:44AE  FE 80               	cp  -maxspeed       ; MAX SPEED
     943   00:44B0  28 05               	jr  z,1f
     944   00:44B2  C6 FF               	add a,-maxspeedstep
     945   00:44B4  32 06 E0            	ld  (dxmap),a
     946   00:44B7                      1:
     947   00:44B7                      	; y position
     948   00:44B7  7D                  	ld  a,l
     949   00:44B8  E6 20               	and 0x20    ; up
     950   00:44BA  20 0C               	jr  nz,1f
     951   00:44BC  3A 07 E0            	ld  a,(dymap)
     952   00:44BF  FE 80               	cp  -maxspeed        ; MAX SPEED
     953   00:44C1  28 05               	jr  z,1f
     954   00:44C3  C6 FF               	add a,-maxspeedstep
     955   00:44C5  32 07 E0            	ld  (dymap),a
     956   00:44C8                      1:
     957   00:44C8  7D                  	ld  a,l
     958   00:44C9  E6 40               	and 0x40    ; down
     959   00:44CB  20 0C               	jr  nz,1f
     960   00:44CD  3A 07 E0            	ld  a,(dymap)
     961   00:44D0  FE 80               	cp  maxspeed       ; MAX SPEED
     962   00:44D2  28 05               	jr  z,1f
     963   00:44D4  C6 01               	add a,maxspeedstep
     964   00:44D6  32 07 E0            	ld  (dymap),a
     965   00:44D9                      1:
     966   00:44D9  C9                  	ret
     967   00:44DA                      
     968   00:44DA                      stopx:
     969   00:44DA  AF                  	xor	a
     970   00:44DB  32 06 E0            	ld  (dxmap),a
     971   00:44DE  21 00 00            	ld	hl,0
     972   00:44E1  C9                  	ret
     973   00:44E2                      stopy:
     974   00:44E2  AF                  	xor	a
     975   00:44E3  32 07 E0            	ld  (dymap),a
     976   00:44E6  21 00 00            	ld	hl,0
     977   00:44E9  C9                  	ret
     978   00:44EA                      
     979   00:44EA                      sub_main:
     980   00:44EA                      	; x speed control
     981   00:44EA  1E 08               	ld  e,8
     982   00:44EC  CD 10 40            	call    checkkbd
     983   00:44EF  CD 95 44            	call	dxdycontrol
     984   00:44F2                      
     985   00:44F2  ED 5B 02 E0         	ld  de,(xmap)		; FP 4.4
     986   00:44F6  3A 06 E0            	ld  a,(dxmap)
     987   00:44F9  6F                  	ld  l,a
     988   00:44FA  87                  	add a,a
     989   00:44FB  9F                  	sbc a,a
     990   00:44FC  67                  	ld  h,a
     991   00:44FD  29 29 29 29         [4]	add	hl,hl
     992   00:4501  A7                  	and a
     993   00:4502  ED 5A               	adc hl,de
     994   00:4504  FC DA 44            	call	m,stopx
     995   00:4507  11 C0 3F            	ld	de,(LvlWidth-32)*256-64
     996   00:450A  A7                  	and a
     997   00:450B  ED 52               	sbc	hl,de
     998   00:450D  F4 DA 44            	call	p,stopx
     999   00:4510  19                  	add	hl,de
    1000   00:4511  22 02 E0            	ld  (xmap),hl
    1001   00:4514                      
    1002   00:4514  ED 5B 04 E0         	ld  de,(ymap)		; FP 4.4
    1003   00:4518  3A 07 E0            	ld  a,(dymap)
    1004   00:451B  6F                  	ld  l,a
    1005   00:451C  87                  	add a,a
    1006   00:451D  9F                  	sbc a,a
    1007   00:451E  67                  	ld  h,a
    1008   00:451F  29 29 29 29         [4]	add	hl,hl
    1009   00:4523  A7                  	and	a
    1010   00:4524  ED 5A               	adc hl,de
    1011   00:4526  FC E2 44            	call	m,stopy
    1012   00:4529  11 C0 1F            	ld	de,(LvlHeigh-16)*256-64
    1013   00:452C  A7                  	and a
    1014   00:452D  ED 52               	sbc	hl,de
    1015   00:452F  F4 E2 44            	call	p,stopy
    1016   00:4532  19                  	add	hl,de
    1017   00:4533  22 04 E0            	ld  (ymap),hl
    1018   00:4536                      
    1019   00:4536                      
    1020   00:4536  3A 02 E0            	ld	a,(xmap)	; xmap 8.8
    1021   00:4539  07 07               [2]	rlca
    1022   00:453B  E6 03               	and		%00000011
    1023   00:453D  47                  	ld	b,a
    1024   00:453E  3A 04 E0            	ld	a,(ymap)	; ymap 8.8
    1025   00:4541  07 07 07 07         [4]	rlca
    1026   00:4545  E6 0C               	and		%00001100
    1027   00:4547  B0                  	or	b
    1028   00:4548  32 08 E0            	ld	(phase),a
    1029   00:454B  C9                  	ret
    1030   00:454C                      
    1031   00:454C                      
    1032   00:454C                      
    1033   00:454C                      

    LABELS
-------------------------------------------------
00:00000060   LvlWidth
00:00000030   LvlHeigh
00:000000CA   CommonTiles
00:000000E8   TileSize11
00:000000F9   TileSize13
00:000000F8   TileSize15
00:000000F6   TileSize17
00:000000FA   TileSize31
00:000000FF   TileSize33
00:000000FF   TileSize35
00:000000FF   TileSize37
00:000000FF   TileSize51
00:000000FF   TileSize53
00:000000FF   TileSize55
00:000000FF   TileSize57
00:000000F5   TileSize71
00:000000FF   TileSize73
00:00000100   TileSize75
00:00000100   TileSize77
03:0000A000   tileset
03:0000A400   scorebar_sat
04:0000A000   common_pattern
04:0000A650   common_color
05:0000A000   test_spt
05:0000AF50   test_sat
05:00000080 S counter
06:0000A000   metamap
07:0000A000   metavec
08:0000A000   patterns_base
08:0000A000   patterns11_13_15_17
09:0000A000   patterns31_33_35_37
0A:0000A000   patterns51_53_55_57
0B:0000A000   patterns71_73_75_77
0C:0000A000 X colors_base
0C:0000A000 X colors11_13_15_17
0D:0000A000 X colors31_33_35_37
0E:0000A000 X colors51_53_55_57
0F:0000A000 X colors71_73_75_77
0F:00005000   _bank1
0F:00007000   _bank2
0F:00009000   _bank3
0F:0000B000   _bank4
0F:00000080   maxspeed
0F:00000001   maxspeedstep
0F:0000C000   buffer
0F:0000E000   slotvar
0F:0000E001 X slotram
0F:0000E002   xmap
0F:0000E004   ymap
0F:0000E006   dxmap
0F:0000E007   dymap
0F:0000E008   phase
0F:0000E009   vpage
02:00008000   myisr
02:00008056 X page1
02:00008069   page0
00:000000A9   i8255portb
00:000000AA   i8255portc
00:00004010   checkkbd
00:0000F3DF   _vdpReg
00:0000F3AE X LINL40
00:0000401B   _scr2
00:00004029   set_sprites
00:00004052   write_256
00:00004064   initcommontiles
00:000040B1   setvramp
00:000040BB   setvramp1
00:000040EE   setvramp0
00:00004121   getbank
00:0000412D   getaddr
00:0000413B   getsize
00:00004147   tilebank
00:00004157   tilesize
00:00004167   tileaddress
00:00004177   write_2k
00:00004194   plot_pnt
00:00004278   plot_pnt.fast_loop
00:00004324 X disp_page1
00:00004335 X disp_page0
00:00000024   ENASLT
00:00000138   RSLREG
00:0000FCC1   EXPTBL
00:00004346   search_slotset
00:0000435E   search_slot
00:0000437F X setrompage0
00:00004384 X recbios
00:00004387   setslotpage0
00:000043BD   vram_init
00:00004406   initmain
00:00004450   mainloop
00:00004468   show_activepage
00:0000446F X show_activepage.page1
00:00004482   show_activepage.page0
00:00004495   dxdycontrol
00:000044DA   stopx
00:000044E2   stopy
00:000044EA   sub_main


 Output: src\main128.out
-------------------------------------------------

 Page: 00
  Org: 00004000  Size: *  Used: 00000000

    No output

 Output: Scrll8way128.rom
-------------------------------------------------

 Page: 00
  Org: 00004000  Size: 00002000  Used: 0000054C

   Address   Length Align   Label
   00004000    1356         checkkbd
   0000454C    6836       <empty>

 Page: 01
  Org: 00006000  Size: 00002000  Used: 00000000

   00006000    8192       <empty>

 Page: 02
  Org: 00008000  Size: 00002000  Used: 00000099

   Address   Length Align   Label
   00008000     153         myisr
   00008099    8039       <empty>

 Page: 03
  Org: 0000A000  Size: 00002000  Used: 00000415

   Address   Length Align   Label
   0000A000    1045         tileset
   0000A415    7147       <empty>

 Page: 04
  Org: 0000A000  Size: 00002000  Used: 00000CA0

   Address   Length Align   Label
   0000A000    3232         common_pattern
   0000ACA0    4960       <empty>

 Page: 05
  Org: 0000A000  Size: 00002000  Used: 00000FD0

   Address   Length Align   Label
   0000A000    4048         test_spt
   0000AFD0    4144       <empty>

 Page: 06
  Org: 0000A000  Size: 00002000  Used: 00001200

   Address   Length Align   Label
   0000A000    4608         metamap
   0000B200    3584       <empty>

 Page: 07
  Org: 0000A000  Size: 00002000  Used: 00001000

   Address   Length Align   Label
   0000A000    4096         metavec
   0000B000    4096       <empty>

 Page: 08
  Org: 0000A000  Size: 00002000  Used: 000019B0

   Address   Length Align   Label
   0000A000    6576         patterns_base
   0000B9B0    1616       <empty>

 Page: 09
  Org: 0000A000  Size: 00002000  Used: 000019B0

   Address   Length Align   Label
   0000A000    6576         patterns31_33_35_37
   0000B9B0    1616       <empty>

 Page: 0A
  Org: 0000A000  Size: 00002000  Used: 000019B0

   Address   Length Align   Label
   0000A000    6576         patterns51_53_55_57
   0000B9B0    1616       <empty>

 Page: 0B
  Org: 0000A000  Size: 00002000  Used: 000019B0

   Address   Length Align   Label
   0000A000    6576         patterns71_73_75_77
   0000B9B0    1616       <empty>

 Page: 0C
  Org: 0000A000  Size: 00002000  Used: 000019B0

   Address   Length Align   Label
   0000A000    6576         colors_base
   0000B9B0    1616       <empty>

 Page: 0D
  Org: 0000A000  Size: 00002000  Used: 000019B0

   Address   Length Align   Label
   0000A000    6576         colors31_33_35_37
   0000B9B0    1616       <empty>

 Page: 0E
  Org: 0000A000  Size: 00002000  Used: 000019B0

   Address   Length Align   Label
   0000A000    6576         colors51_53_55_57
   0000B9B0    1616       <empty>

 Page: 0F
  Org: 0000A000  Size: 00002000  Used: 000019B0

   Address   Length Align   Label
   0000A000    6576         colors71_73_75_77
   0000B9B0    1616       <empty>
